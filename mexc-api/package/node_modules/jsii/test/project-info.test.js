"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const spec = require("@jsii/spec");
const clone = require("clone");
const fs = require("fs-extra");
const os = require("os");
const path = require("path");
const ts = require("typescript");
const project_info_1 = require("../lib/project-info");
const version_1 = require("../lib/version");
const BASE_PROJECT = {
    name: 'jsii-test',
    version: '1.0.0',
    description: 'A test project for jsii ProjectInfo loading',
    license: 'Apache-2.0',
    author: {
        name: 'Amazon Web Services',
        url: 'https://aws.amazon.com',
        organization: true,
    },
    repository: { url: 'git://github.com/aws/jsii.git' },
    main: 'index.js',
    types: 'index.d.ts',
    jsii: {
        targets: { foo: { bar: 'baz' } },
    },
    dependencies: { 'jsii-test-dep': '^1.2.3' },
    peerDependencies: { 'jsii-test-dep': '^1.2.3' },
};
describe('loadProjectInfo', () => {
    test('loads valid project', () => _withTestProject(async (projectRoot) => {
        var _a, _b;
        const { projectInfo: info } = await project_info_1.loadProjectInfo(projectRoot);
        expect(info.name).toBe(BASE_PROJECT.name);
        expect(info.version).toBe(BASE_PROJECT.version);
        expect(info.description).toBe(BASE_PROJECT.description);
        expect(info.license).toBe(BASE_PROJECT.license);
        expect(_stripUndefined(info.author)).toEqual({
            ...BASE_PROJECT.author,
            roles: ['author'],
        });
        expect(info.main).toBe(BASE_PROJECT.main);
        expect(info.types).toBe(BASE_PROJECT.types);
        expect(info.homepage).toBe(undefined);
        expect((_a = info.repository) === null || _a === void 0 ? void 0 : _a.type).toBe('git');
        expect((_b = info.repository) === null || _b === void 0 ? void 0 : _b.url).toBe(BASE_PROJECT.repository.url);
        expect(info.targets).toEqual({
            ...BASE_PROJECT.jsii.targets,
            js: { npm: BASE_PROJECT.name },
        });
        expect(info.dependencies).toEqual({
            [TEST_DEP_ASSEMBLY.name]: BASE_PROJECT.dependencies[TEST_DEP_ASSEMBLY.name],
        });
        expect(info.dependencyClosure).toEqual([
            TEST_DEP_ASSEMBLY,
            TEST_DEP_DEP_ASSEMBLY,
        ]);
    }));
    test('loads valid project (UNLICENSED)', () => _withTestProject(async (projectRoot) => {
        const { projectInfo: info } = await project_info_1.loadProjectInfo(projectRoot);
        expect(info === null || info === void 0 ? void 0 : info.license).toBe('UNLICENSED');
    }, (info) => {
        info.license = 'UNLICENSED';
    }));
    test('loads valid project (using bundleDependencies)', () => _withTestProject(async (projectRoot) => {
        const { projectInfo: info } = await project_info_1.loadProjectInfo(projectRoot);
        expect(info.bundleDependencies).toEqual({ bundled: '^1.2.3' });
    }, (info) => {
        info.dependencies.bundled = '^1.2.3';
        info.bundleDependencies = ['bundled'];
    }));
    test('loads valid project (using bundledDependencies)', () => _withTestProject(async (projectRoot) => {
        const { projectInfo: info } = await project_info_1.loadProjectInfo(projectRoot);
        expect(info.bundleDependencies).toEqual({ bundled: '^1.2.3' });
    }, (info) => {
        info.dependencies.bundled = '^1.2.3';
        info.bundledDependencies = ['bundled'];
    }));
    test('loads valid project (with contributors)', () => {
        const contributors = [{ name: 'foo', email: 'nobody@amazon.com' }];
        return _withTestProject(async (projectRoot) => {
            var _a;
            const { projectInfo: info } = await project_info_1.loadProjectInfo(projectRoot);
            expect((_a = info === null || info === void 0 ? void 0 : info.contributors) === null || _a === void 0 ? void 0 : _a.map(_stripUndefined)).toEqual(contributors.map((c) => ({ ...c, roles: ['contributor'] })));
        }, (info) => (info.contributors = contributors));
    });
    test('rejects un-declared dependency in bundleDependencies', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).rejects.toThrow(/not declared in "dependencies"/i), (info) => {
        info.bundledDependencies = ['bundled'];
    }));
    test('rejects invalid license', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).rejects.toThrow(/invalid license identifier/i), (info) => {
        info.license = 'Not an SPDX licence ID';
    }));
    test('rejects incompatible dependency version', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).rejects.toThrow(/declared dependency on version .+ but version .+ was found/i), (info) => {
        info.dependencies[TEST_DEP_ASSEMBLY.name] = '^1.2.5';
        info.peerDependencies[TEST_DEP_ASSEMBLY.name] = '^1.2.5';
    }));
    test('missing peerDependencies are allowed', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).resolves.toEqual(expect.objectContaining({
        diagnostics: [],
    })), (info) => {
        delete info.peerDependencies[TEST_DEP_ASSEMBLY.name];
    }));
    test('warns if peerDependency misses a matching devDependency', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).resolves.toEqual(expect.objectContaining({
        diagnostics: [expect.objectContaining({ jsiiCode: 6 })],
    })), () => {
        // By default there is no devDependency in BASE_PROJECT
    }));
    test('warns if peerDependency has a devDependency on the wrong version', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).resolves.toEqual(expect.objectContaining({
        diagnostics: [expect.objectContaining({ jsiiCode: 6 })],
    })), (info) => {
        // By default there is no devDependency in BASE_PROJECT
        info.devDependencies = { 'jsii-test-dep': '4.5.6' };
    }));
    test('no warnings if devDependency point version matches peerDependency range', () => _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).resolves.toEqual(expect.objectContaining({
        diagnostics: [],
    })), (info) => {
        // By default there is no devDependency in BASE_PROJECT
        info.devDependencies = { 'jsii-test-dep': '1.2.3' };
    }));
    describe('_loadDiagnostics', () => {
        test('diagnostic categories are correctly detected', () => {
            return _withTestProject(async (projectRoot) => {
                const { projectInfo: info } = await project_info_1.loadProjectInfo(projectRoot);
                expect(info.diagnostics).toBeDefined();
                const diagnostics = info.diagnostics;
                expect(Object.keys(diagnostics).sort()).toEqual([
                    'diagCode1',
                    'diagCode2',
                    'diagCode3',
                    'diagCode4',
                ]);
                expect(diagnostics.diagCode1).toEqual(ts.DiagnosticCategory.Error);
                expect(diagnostics.diagCode2).toEqual(ts.DiagnosticCategory.Warning);
                expect(diagnostics.diagCode3).toEqual(ts.DiagnosticCategory.Suggestion);
                expect(diagnostics.diagCode4).toEqual(ts.DiagnosticCategory.Message);
            }, (info) => {
                const diagnostics = {
                    diagCode1: 'error',
                    diagCode2: 'warning',
                    diagCode3: 'suggestion',
                    diagCode4: 'message',
                };
                info.jsii.diagnostics = diagnostics;
            });
        });
        test('invalid category is rejected', () => {
            return _withTestProject((projectRoot) => expect(project_info_1.loadProjectInfo(projectRoot)).rejects.toThrow(/Invalid category/), (info) => {
                const diagnostics = {
                    diagCode1: 'invalid-category',
                };
                info.jsii.diagnostics = diagnostics;
            });
        });
    });
});
const TEST_DEP_ASSEMBLY = {
    schema: spec.SchemaVersion.LATEST,
    name: 'jsii-test-dep',
    version: '1.2.4',
    license: 'Apache-2.0',
    description: 'A jsii dependency of jsii-test',
    homepage: 'https://github.com/aws/jsii',
    repository: { type: 'git', url: 'git://github.com/aws/jsii.git' },
    author: {
        name: 'Amazon Web Services',
        url: 'https://aws.amazon.com',
        organization: true,
        roles: ['author'],
    },
    fingerprint: 'F1NG3RPR1N7',
    dependencies: {
        'jsii-test-dep-dep': '3.2.1',
    },
    jsiiVersion: version_1.VERSION,
};
const TEST_DEP_DEP_ASSEMBLY = {
    schema: spec.SchemaVersion.LATEST,
    name: 'jsii-test-dep-dep',
    version: '3.2.1',
    license: 'Apache-2.0',
    description: 'A jsii dependency of jsii-test-dep',
    homepage: 'https://github.com/aws/jsii',
    repository: { type: 'git', url: 'git://github.com/aws/jsii.git' },
    author: {
        name: 'Amazon Web Services',
        url: 'https://aws.amazon.com',
        organization: true,
        roles: ['author'],
    },
    jsiiVersion: version_1.VERSION,
    fingerprint: 'F1NG3RPR1N7',
};
/**
 * Creates a throw-away directory with a ``package.json`` file. Cleans up after itself.
 *
 * @param cb      a callback that will be invoked with the temporary directory's path
 * @param gremlin a function that can modify the content of ``package.json`` before it is written
 *
 * @return the result of executing ``cb``.
 */
async function _withTestProject(cb, gremlin) {
    const tmpdir = await fs.mkdtemp(path.join(os.tmpdir(), path.basename(__filename)));
    try {
        const packageInfo = clone(BASE_PROJECT);
        if (gremlin) {
            gremlin(packageInfo);
        }
        await fs.writeJson(path.join(tmpdir, 'package.json'), packageInfo, {
            spaces: 2,
        });
        await fs.writeFile(path.join(tmpdir, 'index.js'), '// There ought to be some javascript');
        await fs.writeFile(path.join(tmpdir, 'index.ts'), '// There ought to be some typescript');
        await fs.writeFile(path.join(tmpdir, 'index.d.ts'), '// There ought to be some typescript definitions');
        const jsiiTestDep = path.join(tmpdir, 'node_modules', 'jsii-test-dep');
        await fs.mkdirs(jsiiTestDep);
        await fs.writeJson(path.join(jsiiTestDep, '.jsii'), TEST_DEP_ASSEMBLY);
        const jsiiTestDepDep = path.join(jsiiTestDep, 'node_modules', 'jsii-test-dep-dep');
        await fs.mkdirs(jsiiTestDepDep);
        await fs.writeJson(path.join(jsiiTestDepDep, '.jsii'), TEST_DEP_DEP_ASSEMBLY);
        return await cb(tmpdir);
    }
    finally {
        await fs.remove(tmpdir);
    }
}
/**
 * Removes keys from an object if the associated value is ``undefined``.
 *
 * @param obj the object to be stripped.
 *
 * @return ``obj`` after it has been stripped.
 */
function _stripUndefined(obj) {
    if (!obj) {
        return obj;
    }
    for (const key of Object.keys(obj)) {
        if (obj[key] === undefined) {
            delete obj[key];
        }
    }
    return obj;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvamVjdC1pbmZvLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcm9qZWN0LWluZm8udGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFtQztBQUNuQywrQkFBK0I7QUFDL0IsK0JBQStCO0FBQy9CLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsaUNBQWlDO0FBRWpDLHNEQUFzRDtBQUN0RCw0Q0FBeUM7QUFFekMsTUFBTSxZQUFZLEdBQUc7SUFDbkIsSUFBSSxFQUFFLFdBQVc7SUFDakIsT0FBTyxFQUFFLE9BQU87SUFDaEIsV0FBVyxFQUFFLDZDQUE2QztJQUMxRCxPQUFPLEVBQUUsWUFBWTtJQUNyQixNQUFNLEVBQUU7UUFDTixJQUFJLEVBQUUscUJBQXFCO1FBQzNCLEdBQUcsRUFBRSx3QkFBd0I7UUFDN0IsWUFBWSxFQUFFLElBQUk7S0FDbkI7SUFDRCxVQUFVLEVBQUUsRUFBRSxHQUFHLEVBQUUsK0JBQStCLEVBQUU7SUFDcEQsSUFBSSxFQUFFLFVBQVU7SUFDaEIsS0FBSyxFQUFFLFlBQVk7SUFDbkIsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO0tBQ2pDO0lBQ0QsWUFBWSxFQUFFLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBZ0M7SUFDekUsZ0JBQWdCLEVBQUUsRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFnQztDQUM5RSxDQUFDO0FBRUYsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFLENBQy9CLGdCQUFnQixDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsRUFBRTs7UUFDckMsTUFBTSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLDhCQUFlLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNoRCxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDeEQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2hELE1BQU0sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQzNDLEdBQUcsWUFBWSxDQUFDLE1BQU07WUFDdEIsS0FBSyxFQUFFLENBQUMsUUFBUSxDQUFDO1NBQ2xCLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEMsTUFBTSxPQUFDLElBQUksQ0FBQyxVQUFVLDBDQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxQyxNQUFNLE9BQUMsSUFBSSxDQUFDLFVBQVUsMENBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0QsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDM0IsR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU87WUFDNUIsRUFB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QUFjLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDdkUsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdCLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3ZFLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQzlCLFdBQVcsRUFDWCxjQUFjLEVBQ2QsbUJBQW1CLENBQ3BCLENBQUM7UUFDRixNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDaEMsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsRUFDbEMscUJBQXFCLENBQ3RCLENBQUM7UUFFRixPQUFPLE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ3pCO1lBQVM7UUFDUixNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDekI7QUFDSCxDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0gsU0FBUyxlQUFlLENBQ3RCLEdBQXVDO0lBRXZDLElBQUksQ0FBQyxHQUFHLEVBQUU7UUFDUixPQUFPLEdBQUcsQ0FBQztLQUNaO0lBQ0QsS0FBSyxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ2xDLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLFNBQVMsRUFBRTtZQUMxQixPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNqQjtLQUNGO0lBQ0QsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgc3BlYyBmcm9tICdAanNpaS9zcGVjJztcbmltcG9ydCAqIGFzIGNsb25lIGZyb20gJ2Nsb25lJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCAqIGFzIG9zIGZyb20gJ29zJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyB0cyBmcm9tICd0eXBlc2NyaXB0JztcblxuaW1wb3J0IHsgbG9hZFByb2plY3RJbmZvIH0gZnJvbSAnLi4vbGliL3Byb2plY3QtaW5mbyc7XG5pbXBvcnQgeyBWRVJTSU9OIH0gZnJvbSAnLi4vbGliL3ZlcnNpb24nO1xuXG5jb25zdCBCQVNFX1BST0pFQ1QgPSB7XG4gIG5hbWU6ICdqc2lpLXRlc3QnLFxuICB2ZXJzaW9uOiAnMS4wLjAnLFxuICBkZXNjcmlwdGlvbjogJ0EgdGVzdCBwcm9qZWN0IGZvciBqc2lpIFByb2plY3RJbmZvIGxvYWRpbmcnLFxuICBsaWNlbnNlOiAnQXBhY2hlLTIuMCcsXG4gIGF1dGhvcjoge1xuICAgIG5hbWU6ICdBbWF6b24gV2ViIFNlcnZpY2VzJyxcbiAgICB1cmw6ICdodHRwczovL2F3cy5hbWF6b24uY29tJyxcbiAgICBvcmdhbml6YXRpb246IHRydWUsXG4gIH0sXG4gIHJlcG9zaXRvcnk6IHsgdXJsOiAnZ2l0Oi8vZ2l0aHViLmNvbS9hd3MvanNpaS5naXQnIH0sXG4gIG1haW46ICdpbmRleC5qcycsXG4gIHR5cGVzOiAnaW5kZXguZC50cycsXG4gIGpzaWk6IHtcbiAgICB0YXJnZXRzOiB7IGZvbzogeyBiYXI6ICdiYXonIH0gfSxcbiAgfSxcbiAgZGVwZW5kZW5jaWVzOiB7ICdqc2lpLXRlc3QtZGVwJzogJ14xLjIuMycgfSBhcyB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfSxcbiAgcGVlckRlcGVuZGVuY2llczogeyAnanNpaS10ZXN0LWRlcCc6ICdeMS4yLjMnIH0gYXMgeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIH0sXG59O1xuXG5kZXNjcmliZSgnbG9hZFByb2plY3RJbmZvJywgKCkgPT4ge1xuICB0ZXN0KCdsb2FkcyB2YWxpZCBwcm9qZWN0JywgKCkgPT5cbiAgICBfd2l0aFRlc3RQcm9qZWN0KGFzeW5jIChwcm9qZWN0Um9vdCkgPT4ge1xuICAgICAgY29uc3QgeyBwcm9qZWN0SW5mbzogaW5mbyB9ID0gYXdhaXQgbG9hZFByb2plY3RJbmZvKHByb2plY3RSb290KTtcbiAgICAgIGV4cGVjdChpbmZvLm5hbWUpLnRvQmUoQkFTRV9QUk9KRUNULm5hbWUpO1xuICAgICAgZXhwZWN0KGluZm8udmVyc2lvbikudG9CZShCQVNFX1BST0pFQ1QudmVyc2lvbik7XG4gICAgICBleHBlY3QoaW5mby5kZXNjcmlwdGlvbikudG9CZShCQVNFX1BST0pFQ1QuZGVzY3JpcHRpb24pO1xuICAgICAgZXhwZWN0KGluZm8ubGljZW5zZSkudG9CZShCQVNFX1BST0pFQ1QubGljZW5zZSk7XG4gICAgICBleHBlY3QoX3N0cmlwVW5kZWZpbmVkKGluZm8uYXV0aG9yKSkudG9FcXVhbCh7XG4gICAgICAgIC4uLkJBU0VfUFJPSkVDVC5hdXRob3IsXG4gICAgICAgIHJvbGVzOiBbJ2F1dGhvciddLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoaW5mby5tYWluKS50b0JlKEJBU0VfUFJPSkVDVC5tYWluKTtcbiAgICAgIGV4cGVjdChpbmZvLnR5cGVzKS50b0JlKEJBU0VfUFJPSkVDVC50eXBlcyk7XG4gICAgICBleHBlY3QoaW5mby5ob21lcGFnZSkudG9CZSh1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KGluZm8ucmVwb3NpdG9yeT8udHlwZSkudG9CZSgnZ2l0Jyk7XG4gICAgICBleHBlY3QoaW5mby5yZXBvc2l0b3J5Py51cmwpLnRvQmUoQkFTRV9QUk9KRUNULnJlcG9zaXRvcnkudXJsKTtcbiAgICAgIGV4cGVjdChpbmZvLnRhcmdldHMpLnRvRXF1YWwoe1xuICAgICAgICAuLi5CQVNFX1BST0pFQ1QuanNpaS50YXJnZXRzLFxuICAgICAgICBqczogeyBucG06IEJBU0VfUFJPSkVDVC5uYW1lIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChpbmZvLmRlcGVuZGVuY2llcykudG9FcXVhbCh7XG4gICAgICAgIFtURVNUX0RFUF9BU1NFTUJMWS5uYW1lXTpcbiAgICAgICAgICBCQVNFX1BST0pFQ1QuZGVwZW5kZW5jaWVzW1RFU1RfREVQX0FTU0VNQkxZLm5hbWVdLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoaW5mby5kZXBlbmRlbmN5Q2xvc3VyZSkudG9FcXVhbChbXG4gICAgICAgIFRFU1RfREVQX0FTU0VNQkxZLFxuICAgICAgICBURVNUX0RFUF9ERVBfQVNTRU1CTFksXG4gICAgICBdKTtcbiAgICB9KSk7XG5cbiAgdGVzdCgnbG9hZHMgdmFsaWQgcHJvamVjdCAoVU5MSUNFTlNFRCknLCAoKSA9PlxuICAgIF93aXRoVGVzdFByb2plY3QoXG4gICAgICBhc3luYyAocHJvamVjdFJvb3QpID0+IHtcbiAgICAgICAgY29uc3QgeyBwcm9qZWN0SW5mbzogaW5mbyB9ID0gYXdhaXQgbG9hZFByb2plY3RJbmZvKHByb2plY3RSb290KTtcbiAgICAgICAgZXhwZWN0KGluZm8/LmxpY2Vuc2UpLnRvQmUoJ1VOTElDRU5TRUQnKTtcbiAgICAgIH0sXG4gICAgICAoaW5mbykgPT4ge1xuICAgICAgICBpbmZvLmxpY2Vuc2UgPSAnVU5MSUNFTlNFRCc7XG4gICAgICB9LFxuICAgICkpO1xuXG4gIHRlc3QoJ2xvYWRzIHZhbGlkIHByb2plY3QgKHVzaW5nIGJ1bmRsZURlcGVuZGVuY2llcyknLCAoKSA9PlxuICAgIF93aXRoVGVzdFByb2plY3QoXG4gICAgICBhc3luYyAocHJvamVjdFJvb3QpID0+IHtcbiAgICAgICAgY29uc3QgeyBwcm9qZWN0SW5mbzogaW5mbyB9ID0gYXdhaXQgbG9hZFByb2plY3RJbmZvKHByb2plY3RSb290KTtcbiAgICAgICAgZXhwZWN0KGluZm8uYnVuZGxlRGVwZW5kZW5jaWVzKS50b0VxdWFsKHsgYnVuZGxlZDogJ14xLjIuMycgfSk7XG4gICAgICB9LFxuICAgICAgKGluZm8pID0+IHtcbiAgICAgICAgaW5mby5kZXBlbmRlbmNpZXMuYnVuZGxlZCA9ICdeMS4yLjMnO1xuICAgICAgICBpbmZvLmJ1bmRsZURlcGVuZGVuY2llcyA9IFsnYnVuZGxlZCddO1xuICAgICAgfSxcbiAgICApKTtcblxuICB0ZXN0KCdsb2FkcyB2YWxpZCBwcm9qZWN0ICh1c2luZyBidW5kbGVkRGVwZW5kZW5jaWVzKScsICgpID0+XG4gICAgX3dpdGhUZXN0UHJvamVjdChcbiAgICAgIGFzeW5jIChwcm9qZWN0Um9vdCkgPT4ge1xuICAgICAgICBjb25zdCB7IHByb2plY3RJbmZvOiBpbmZvIH0gPSBhd2FpdCBsb2FkUHJvamVjdEluZm8ocHJvamVjdFJvb3QpO1xuICAgICAgICBleHBlY3QoaW5mby5idW5kbGVEZXBlbmRlbmNpZXMpLnRvRXF1YWwoeyBidW5kbGVkOiAnXjEuMi4zJyB9KTtcbiAgICAgIH0sXG4gICAgICAoaW5mbykgPT4ge1xuICAgICAgICBpbmZvLmRlcGVuZGVuY2llcy5idW5kbGVkID0gJ14xLjIuMyc7XG4gICAgICAgIGluZm8uYnVuZGxlZERlcGVuZGVuY2llcyA9IFsnYnVuZGxlZCddO1xuICAgICAgfSxcbiAgICApKTtcblxuICB0ZXN0KCdsb2FkcyB2YWxpZCBwcm9qZWN0ICh3aXRoIGNvbnRyaWJ1dG9ycyknLCAoKSA9PiB7XG4gICAgY29uc3QgY29udHJpYnV0b3JzID0gW3sgbmFtZTogJ2ZvbycsIGVtYWlsOiAnbm9ib2R5QGFtYXpvbi5jb20nIH1dO1xuICAgIHJldHVybiBfd2l0aFRlc3RQcm9qZWN0KFxuICAgICAgYXN5bmMgKHByb2plY3RSb290KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcHJvamVjdEluZm86IGluZm8gfSA9IGF3YWl0IGxvYWRQcm9qZWN0SW5mbyhwcm9qZWN0Um9vdCk7XG4gICAgICAgIGV4cGVjdChpbmZvPy5jb250cmlidXRvcnM/Lm1hcChfc3RyaXBVbmRlZmluZWQpKS50b0VxdWFsKFxuICAgICAgICAgIGNvbnRyaWJ1dG9ycy5tYXAoKGMpID0+ICh7IC4uLmMsIHJvbGVzOiBbJ2NvbnRyaWJ1dG9yJ10gfSkpLFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIChpbmZvKSA9PiAoaW5mby5jb250cmlidXRvcnMgPSBjb250cmlidXRvcnMpLFxuICAgICk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlamVjdHMgdW4tZGVjbGFyZWQgZGVwZW5kZW5jeSBpbiBidW5kbGVEZXBlbmRlbmNpZXMnLCAoKSA9PlxuICAgIF93aXRoVGVzdFByb2plY3QoXG4gICAgICAocHJvamVjdFJvb3QpID0+XG4gICAgICAgIGV4cGVjdChsb2FkUHJvamVjdEluZm8ocHJvamVjdFJvb3QpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICAgL25vdCBkZWNsYXJlZCBpbiBcImRlcGVuZGVuY2llc1wiL2ksXG4gICAgICAgICksXG4gICAgICAoaW5mbykgPT4ge1xuICAgICAgICBpbmZvLmJ1bmRsZWREZXBlbmRlbmNpZXMgPSBbJ2J1bmRsZWQnXTtcbiAgICAgIH0sXG4gICAgKSk7XG5cbiAgdGVzdCgncmVqZWN0cyBpbnZhbGlkIGxpY2Vuc2UnLCAoKSA9PlxuICAgIF93aXRoVGVzdFByb2plY3QoXG4gICAgICAocHJvamVjdFJvb3QpID0+XG4gICAgICAgIGV4cGVjdChsb2FkUHJvamVjdEluZm8ocHJvamVjdFJvb3QpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICAgL2ludmFsaWQgbGljZW5zZSBpZGVudGlmaWVyL2ksXG4gICAgICAgICksXG4gICAgICAoaW5mbykgPT4ge1xuICAgICAgICBpbmZvLmxpY2Vuc2UgPSAnTm90IGFuIFNQRFggbGljZW5jZSBJRCc7XG4gICAgICB9LFxuICAgICkpO1xuXG4gIHRlc3QoJ3JlamVjdHMgaW5jb21wYXRpYmxlIGRlcGVuZGVuY3kgdmVyc2lvbicsICgpID0+XG4gICAgX3dpdGhUZXN0UHJvamVjdChcbiAgICAgIChwcm9qZWN0Um9vdCkgPT5cbiAgICAgICAgZXhwZWN0KGxvYWRQcm9qZWN0SW5mbyhwcm9qZWN0Um9vdCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgICAvZGVjbGFyZWQgZGVwZW5kZW5jeSBvbiB2ZXJzaW9uIC4rIGJ1dCB2ZXJzaW9uIC4rIHdhcyBmb3VuZC9pLFxuICAgICAgICApLFxuICAgICAgKGluZm8pID0+IHtcbiAgICAgICAgaW5mby5kZXBlbmRlbmNpZXNbVEVTVF9ERVBfQVNTRU1CTFkubmFtZV0gPSAnXjEuMi41JztcbiAgICAgICAgaW5mby5wZWVyRGVwZW5kZW5jaWVzW1RFU1RfREVQX0FTU0VNQkxZLm5hbWVdID0gJ14xLjIuNSc7XG4gICAgICB9LFxuICAgICkpO1xuXG4gIHRlc3QoJ21pc3NpbmcgcGVlckRlcGVuZGVuY2llcyBhcmUgYWxsb3dlZCcsICgpID0+XG4gICAgX3dpdGhUZXN0UHJvamVjdChcbiAgICAgIChwcm9qZWN0Um9vdCkgPT5cbiAgICAgICAgZXhwZWN0KGxvYWRQcm9qZWN0SW5mbyhwcm9qZWN0Um9vdCkpLnJlc29sdmVzLnRvRXF1YWwoXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgZGlhZ25vc3RpY3M6IFtdLFxuICAgICAgICAgIH0pLFxuICAgICAgICApLFxuICAgICAgKGluZm8pID0+IHtcbiAgICAgICAgZGVsZXRlIGluZm8ucGVlckRlcGVuZGVuY2llc1tURVNUX0RFUF9BU1NFTUJMWS5uYW1lXTtcbiAgICAgIH0sXG4gICAgKSk7XG5cbiAgdGVzdCgnd2FybnMgaWYgcGVlckRlcGVuZGVuY3kgbWlzc2VzIGEgbWF0Y2hpbmcgZGV2RGVwZW5kZW5jeScsICgpID0+XG4gICAgX3dpdGhUZXN0UHJvamVjdChcbiAgICAgIChwcm9qZWN0Um9vdCkgPT5cbiAgICAgICAgZXhwZWN0KGxvYWRQcm9qZWN0SW5mbyhwcm9qZWN0Um9vdCkpLnJlc29sdmVzLnRvRXF1YWwoXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgZGlhZ25vc3RpY3M6IFtleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGpzaWlDb2RlOiA2IH0pXSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgKSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gQnkgZGVmYXVsdCB0aGVyZSBpcyBubyBkZXZEZXBlbmRlbmN5IGluIEJBU0VfUFJPSkVDVFxuICAgICAgfSxcbiAgICApKTtcblxuICB0ZXN0KCd3YXJucyBpZiBwZWVyRGVwZW5kZW5jeSBoYXMgYSBkZXZEZXBlbmRlbmN5IG9uIHRoZSB3cm9uZyB2ZXJzaW9uJywgKCkgPT5cbiAgICBfd2l0aFRlc3RQcm9qZWN0KFxuICAgICAgKHByb2plY3RSb290KSA9PlxuICAgICAgICBleHBlY3QobG9hZFByb2plY3RJbmZvKHByb2plY3RSb290KSkucmVzb2x2ZXMudG9FcXVhbChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBkaWFnbm9zdGljczogW2V4cGVjdC5vYmplY3RDb250YWluaW5nKHsganNpaUNvZGU6IDYgfSldLFxuICAgICAgICAgIH0pLFxuICAgICAgICApLFxuICAgICAgKGluZm8pID0+IHtcbiAgICAgICAgLy8gQnkgZGVmYXVsdCB0aGVyZSBpcyBubyBkZXZEZXBlbmRlbmN5IGluIEJBU0VfUFJPSkVDVFxuICAgICAgICBpbmZvLmRldkRlcGVuZGVuY2llcyA9IHsgJ2pzaWktdGVzdC1kZXAnOiAnNC41LjYnIH07XG4gICAgICB9LFxuICAgICkpO1xuXG4gIHRlc3QoJ25vIHdhcm5pbmdzIGlmIGRldkRlcGVuZGVuY3kgcG9pbnQgdmVyc2lvbiBtYXRjaGVzIHBlZXJEZXBlbmRlbmN5IHJhbmdlJywgKCkgPT5cbiAgICBfd2l0aFRlc3RQcm9qZWN0KFxuICAgICAgKHByb2plY3RSb290KSA9PlxuICAgICAgICBleHBlY3QobG9hZFByb2plY3RJbmZvKHByb2plY3RSb290KSkucmVzb2x2ZXMudG9FcXVhbChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBkaWFnbm9zdGljczogW10sXG4gICAgICAgICAgfSksXG4gICAgICAgICksXG4gICAgICAoaW5mbykgPT4ge1xuICAgICAgICAvLyBCeSBkZWZhdWx0IHRoZXJlIGlzIG5vIGRldkRlcGVuZGVuY3kgaW4gQkFTRV9QUk9KRUNUXG4gICAgICAgIGluZm8uZGV2RGVwZW5kZW5jaWVzID0geyAnanNpaS10ZXN0LWRlcCc6ICcxLjIuMycgfTtcbiAgICAgIH0sXG4gICAgKSk7XG5cbiAgZGVzY3JpYmUoJ19sb2FkRGlhZ25vc3RpY3MnLCAoKSA9PiB7XG4gICAgdGVzdCgnZGlhZ25vc3RpYyBjYXRlZ29yaWVzIGFyZSBjb3JyZWN0bHkgZGV0ZWN0ZWQnLCAoKSA9PiB7XG4gICAgICByZXR1cm4gX3dpdGhUZXN0UHJvamVjdChcbiAgICAgICAgYXN5bmMgKHByb2plY3RSb290KSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBwcm9qZWN0SW5mbzogaW5mbyB9ID0gYXdhaXQgbG9hZFByb2plY3RJbmZvKHByb2plY3RSb290KTtcbiAgICAgICAgICBleHBlY3QoaW5mby5kaWFnbm9zdGljcykudG9CZURlZmluZWQoKTtcbiAgICAgICAgICBjb25zdCBkaWFnbm9zdGljcyA9IGluZm8uZGlhZ25vc3RpY3MhO1xuICAgICAgICAgIGV4cGVjdChPYmplY3Qua2V5cyhkaWFnbm9zdGljcykuc29ydCgpKS50b0VxdWFsKFtcbiAgICAgICAgICAgICdkaWFnQ29kZTEnLFxuICAgICAgICAgICAgJ2RpYWdDb2RlMicsXG4gICAgICAgICAgICAnZGlhZ0NvZGUzJyxcbiAgICAgICAgICAgICdkaWFnQ29kZTQnLFxuICAgICAgICAgIF0pO1xuICAgICAgICAgIGV4cGVjdChkaWFnbm9zdGljcy5kaWFnQ29kZTEpLnRvRXF1YWwodHMuRGlhZ25vc3RpY0NhdGVnb3J5LkVycm9yKTtcbiAgICAgICAgICBleHBlY3QoZGlhZ25vc3RpY3MuZGlhZ0NvZGUyKS50b0VxdWFsKHRzLkRpYWdub3N0aWNDYXRlZ29yeS5XYXJuaW5nKTtcbiAgICAgICAgICBleHBlY3QoZGlhZ25vc3RpY3MuZGlhZ0NvZGUzKS50b0VxdWFsKFxuICAgICAgICAgICAgdHMuRGlhZ25vc3RpY0NhdGVnb3J5LlN1Z2dlc3Rpb24sXG4gICAgICAgICAgKTtcbiAgICAgICAgICBleHBlY3QoZGlhZ25vc3RpY3MuZGlhZ0NvZGU0KS50b0VxdWFsKHRzLkRpYWdub3N0aWNDYXRlZ29yeS5NZXNzYWdlKTtcbiAgICAgICAgfSxcbiAgICAgICAgKGluZm8pID0+IHtcbiAgICAgICAgICBjb25zdCBkaWFnbm9zdGljcyA9IHtcbiAgICAgICAgICAgIGRpYWdDb2RlMTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGRpYWdDb2RlMjogJ3dhcm5pbmcnLFxuICAgICAgICAgICAgZGlhZ0NvZGUzOiAnc3VnZ2VzdGlvbicsXG4gICAgICAgICAgICBkaWFnQ29kZTQ6ICdtZXNzYWdlJyxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGluZm8uanNpaS5kaWFnbm9zdGljcyA9IGRpYWdub3N0aWNzO1xuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2ludmFsaWQgY2F0ZWdvcnkgaXMgcmVqZWN0ZWQnLCAoKSA9PiB7XG4gICAgICByZXR1cm4gX3dpdGhUZXN0UHJvamVjdChcbiAgICAgICAgKHByb2plY3RSb290KSA9PlxuICAgICAgICAgIGV4cGVjdChsb2FkUHJvamVjdEluZm8ocHJvamVjdFJvb3QpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICAgICAvSW52YWxpZCBjYXRlZ29yeS8sXG4gICAgICAgICAgKSxcbiAgICAgICAgKGluZm8pID0+IHtcbiAgICAgICAgICBjb25zdCBkaWFnbm9zdGljcyA9IHtcbiAgICAgICAgICAgIGRpYWdDb2RlMTogJ2ludmFsaWQtY2F0ZWdvcnknLFxuICAgICAgICAgIH07XG4gICAgICAgICAgaW5mby5qc2lpLmRpYWdub3N0aWNzID0gZGlhZ25vc3RpY3M7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5jb25zdCBURVNUX0RFUF9BU1NFTUJMWTogc3BlYy5Bc3NlbWJseSA9IHtcbiAgc2NoZW1hOiBzcGVjLlNjaGVtYVZlcnNpb24uTEFURVNULFxuICBuYW1lOiAnanNpaS10ZXN0LWRlcCcsXG4gIHZlcnNpb246ICcxLjIuNCcsXG4gIGxpY2Vuc2U6ICdBcGFjaGUtMi4wJyxcbiAgZGVzY3JpcHRpb246ICdBIGpzaWkgZGVwZW5kZW5jeSBvZiBqc2lpLXRlc3QnLFxuICBob21lcGFnZTogJ2h0dHBzOi8vZ2l0aHViLmNvbS9hd3MvanNpaScsXG4gIHJlcG9zaXRvcnk6IHsgdHlwZTogJ2dpdCcsIHVybDogJ2dpdDovL2dpdGh1Yi5jb20vYXdzL2pzaWkuZ2l0JyB9LFxuICBhdXRob3I6IHtcbiAgICBuYW1lOiAnQW1hem9uIFdlYiBTZXJ2aWNlcycsXG4gICAgdXJsOiAnaHR0cHM6Ly9hd3MuYW1hem9uLmNvbScsXG4gICAgb3JnYW5pemF0aW9uOiB0cnVlLFxuICAgIHJvbGVzOiBbJ2F1dGhvciddLFxuICB9LFxuICBmaW5nZXJwcmludDogJ0YxTkczUlBSMU43JyxcbiAgZGVwZW5kZW5jaWVzOiB7XG4gICAgJ2pzaWktdGVzdC1kZXAtZGVwJzogJzMuMi4xJyxcbiAgfSxcbiAganNpaVZlcnNpb246IFZFUlNJT04sXG59O1xuXG5jb25zdCBURVNUX0RFUF9ERVBfQVNTRU1CTFk6IHNwZWMuQXNzZW1ibHkgPSB7XG4gIHNjaGVtYTogc3BlYy5TY2hlbWFWZXJzaW9uLkxBVEVTVCxcbiAgbmFtZTogJ2pzaWktdGVzdC1kZXAtZGVwJyxcbiAgdmVyc2lvbjogJzMuMi4xJyxcbiAgbGljZW5zZTogJ0FwYWNoZS0yLjAnLFxuICBkZXNjcmlwdGlvbjogJ0EganNpaSBkZXBlbmRlbmN5IG9mIGpzaWktdGVzdC1kZXAnLFxuICBob21lcGFnZTogJ2h0dHBzOi8vZ2l0aHViLmNvbS9hd3MvanNpaScsXG4gIHJlcG9zaXRvcnk6IHsgdHlwZTogJ2dpdCcsIHVybDogJ2dpdDovL2dpdGh1Yi5jb20vYXdzL2pzaWkuZ2l0JyB9LFxuICBhdXRob3I6IHtcbiAgICBuYW1lOiAnQW1hem9uIFdlYiBTZXJ2aWNlcycsXG4gICAgdXJsOiAnaHR0cHM6Ly9hd3MuYW1hem9uLmNvbScsXG4gICAgb3JnYW5pemF0aW9uOiB0cnVlLFxuICAgIHJvbGVzOiBbJ2F1dGhvciddLFxuICB9LFxuICBqc2lpVmVyc2lvbjogVkVSU0lPTixcbiAgZmluZ2VycHJpbnQ6ICdGMU5HM1JQUjFONycsXG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSB0aHJvdy1hd2F5IGRpcmVjdG9yeSB3aXRoIGEgYGBwYWNrYWdlLmpzb25gYCBmaWxlLiBDbGVhbnMgdXAgYWZ0ZXIgaXRzZWxmLlxuICpcbiAqIEBwYXJhbSBjYiAgICAgIGEgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIGludm9rZWQgd2l0aCB0aGUgdGVtcG9yYXJ5IGRpcmVjdG9yeSdzIHBhdGhcbiAqIEBwYXJhbSBncmVtbGluIGEgZnVuY3Rpb24gdGhhdCBjYW4gbW9kaWZ5IHRoZSBjb250ZW50IG9mIGBgcGFja2FnZS5qc29uYGAgYmVmb3JlIGl0IGlzIHdyaXR0ZW5cbiAqXG4gKiBAcmV0dXJuIHRoZSByZXN1bHQgb2YgZXhlY3V0aW5nIGBgY2JgYC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gX3dpdGhUZXN0UHJvamVjdDxUPihcbiAgY2I6IChwcm9qZWN0Um9vdDogc3RyaW5nKSA9PiBUIHwgUHJvbWlzZTxUPixcbiAgZ3JlbWxpbj86IChwYWNrYWdlSW5mbzogYW55KSA9PiB2b2lkLFxuKTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IHRtcGRpciA9IGF3YWl0IGZzLm1rZHRlbXAoXG4gICAgcGF0aC5qb2luKG9zLnRtcGRpcigpLCBwYXRoLmJhc2VuYW1lKF9fZmlsZW5hbWUpKSxcbiAgKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWNrYWdlSW5mbyA9IGNsb25lKEJBU0VfUFJPSkVDVCk7XG4gICAgaWYgKGdyZW1saW4pIHtcbiAgICAgIGdyZW1saW4ocGFja2FnZUluZm8pO1xuICAgIH1cbiAgICBhd2FpdCBmcy53cml0ZUpzb24ocGF0aC5qb2luKHRtcGRpciwgJ3BhY2thZ2UuanNvbicpLCBwYWNrYWdlSW5mbywge1xuICAgICAgc3BhY2VzOiAyLFxuICAgIH0pO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZShcbiAgICAgIHBhdGguam9pbih0bXBkaXIsICdpbmRleC5qcycpLFxuICAgICAgJy8vIFRoZXJlIG91Z2h0IHRvIGJlIHNvbWUgamF2YXNjcmlwdCcsXG4gICAgKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoXG4gICAgICBwYXRoLmpvaW4odG1wZGlyLCAnaW5kZXgudHMnKSxcbiAgICAgICcvLyBUaGVyZSBvdWdodCB0byBiZSBzb21lIHR5cGVzY3JpcHQnLFxuICAgICk7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKFxuICAgICAgcGF0aC5qb2luKHRtcGRpciwgJ2luZGV4LmQudHMnKSxcbiAgICAgICcvLyBUaGVyZSBvdWdodCB0byBiZSBzb21lIHR5cGVzY3JpcHQgZGVmaW5pdGlvbnMnLFxuICAgICk7XG5cbiAgICBjb25zdCBqc2lpVGVzdERlcCA9IHBhdGguam9pbih0bXBkaXIsICdub2RlX21vZHVsZXMnLCAnanNpaS10ZXN0LWRlcCcpO1xuICAgIGF3YWl0IGZzLm1rZGlycyhqc2lpVGVzdERlcCk7XG4gICAgYXdhaXQgZnMud3JpdGVKc29uKHBhdGguam9pbihqc2lpVGVzdERlcCwgJy5qc2lpJyksIFRFU1RfREVQX0FTU0VNQkxZKTtcbiAgICBjb25zdCBqc2lpVGVzdERlcERlcCA9IHBhdGguam9pbihcbiAgICAgIGpzaWlUZXN0RGVwLFxuICAgICAgJ25vZGVfbW9kdWxlcycsXG4gICAgICAnanNpaS10ZXN0LWRlcC1kZXAnLFxuICAgICk7XG4gICAgYXdhaXQgZnMubWtkaXJzKGpzaWlUZXN0RGVwRGVwKTtcbiAgICBhd2FpdCBmcy53cml0ZUpzb24oXG4gICAgICBwYXRoLmpvaW4oanNpaVRlc3REZXBEZXAsICcuanNpaScpLFxuICAgICAgVEVTVF9ERVBfREVQX0FTU0VNQkxZLFxuICAgICk7XG5cbiAgICByZXR1cm4gYXdhaXQgY2IodG1wZGlyKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yZW1vdmUodG1wZGlyKTtcbiAgfVxufVxuXG4vKipcbiAqIFJlbW92ZXMga2V5cyBmcm9tIGFuIG9iamVjdCBpZiB0aGUgYXNzb2NpYXRlZCB2YWx1ZSBpcyBgYHVuZGVmaW5lZGBgLlxuICpcbiAqIEBwYXJhbSBvYmogdGhlIG9iamVjdCB0byBiZSBzdHJpcHBlZC5cbiAqXG4gKiBAcmV0dXJuIGBgb2JqYGAgYWZ0ZXIgaXQgaGFzIGJlZW4gc3RyaXBwZWQuXG4gKi9cbmZ1bmN0aW9uIF9zdHJpcFVuZGVmaW5lZChcbiAgb2JqOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgdW5kZWZpbmVkLFxuKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IHVuZGVmaW5lZCB7XG4gIGlmICghb2JqKSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfVxuICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhvYmopKSB7XG4gICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9iajtcbn1cbiJdfQ==
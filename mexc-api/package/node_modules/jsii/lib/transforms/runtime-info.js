"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RuntimeTypeInfoInjector = void 0;
const ts = require("typescript");
/**
 * Provides a TransformerFactory to annotate classes with runtime information
 * (e.g., fully-qualified name, version).
 *
 * It does this by first inserting this definition at the top of each source file:
 * ```
 * var JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
 * ```
 *
 * Then, for each class that has registered runtime information during assembly,
 * insert a static member to the class with its fqn and version:
 * ```
 * private static readonly [JSII_RTTI_SYMBOL_1] = { fqn: "ModuleName.ClassName", version: "1.2.3" }
 * ```
 */
class RuntimeTypeInfoInjector {
    constructor(version) {
        this.version = version;
        this.fqnsByClass = new Map();
    }
    /**
     * Register the fully-qualified name (fqn) of a class with its ClassDeclaration.
     * Only ClassDeclarations with registered fqns will be annotated.
     */
    registerClassFqn(clazz, fqn) {
        this.fqnsByClass.set(clazz, fqn);
    }
    /**
     * Return the set of Transformers to be used in TSC's program.emit()
     */
    makeTransformers() {
        return {
            before: [this.runtimeTypeTransformer()],
        };
    }
    runtimeTypeTransformer() {
        return (context) => {
            return (sourceFile) => {
                const rttiSymbolIdentifier = ts.createUniqueName('JSII_RTTI_SYMBOL');
                let classesAnnotated = false;
                const visitor = (node) => {
                    if (ts.isClassDeclaration(node)) {
                        const fqn = this.getClassFqn(node);
                        if (fqn) {
                            classesAnnotated = true;
                            return this.addRuntimeInfoToClass(node, fqn, rttiSymbolIdentifier);
                        }
                    }
                    return ts.visitEachChild(node, visitor, context);
                };
                // Visit the source file, annotating the classes.
                let annotatedSourceFile = ts.visitNode(sourceFile, visitor);
                // Only add the symbol definition if it's actually used.
                if (classesAnnotated) {
                    const rttiSymbol = ts.createCall(ts.createPropertyAccess(ts.createIdentifier('Symbol'), ts.createIdentifier('for')), undefined, [ts.createStringLiteral('jsii.rtti')]);
                    const rttiSymbolDeclaration = ts.createVariableDeclaration(rttiSymbolIdentifier, undefined, rttiSymbol);
                    const variableDeclaration = ts.createVariableStatement([], ts.createVariableDeclarationList([rttiSymbolDeclaration], ts.NodeFlags.Const));
                    annotatedSourceFile = ts.updateSourceFileNode(annotatedSourceFile, [
                        variableDeclaration,
                        ...annotatedSourceFile.statements,
                    ]);
                }
                return annotatedSourceFile;
            };
        };
    }
    /** Used instead of direct access to the map to faciliate testing. */
    getClassFqn(clazz) {
        return this.fqnsByClass.get(clazz);
    }
    /**
     * If the ClassDeclaration has an associated fully-qualified name registered,
     * will append a static property to the class with the fqn and version.
     */
    addRuntimeInfoToClass(node, fqn, rttiSymbol) {
        const runtimeInfo = ts.createObjectLiteral([
            ts.createPropertyAssignment(ts.createIdentifier('fqn'), ts.createStringLiteral(fqn)),
            ts.createPropertyAssignment(ts.createIdentifier('version'), ts.createStringLiteral(this.version)),
        ]);
        const runtimeProperty = ts.createProperty(undefined, ts.createModifiersFromModifierFlags(ts.ModifierFlags.Private |
            ts.ModifierFlags.Static |
            ts.ModifierFlags.Readonly), ts.createComputedPropertyName(rttiSymbol), undefined, undefined, runtimeInfo);
        return ts.updateClassDeclaration(node, node.decorators, node.modifiers, node.name, node.typeParameters, node.heritageClauses, [runtimeProperty, ...node.members]);
    }
}
exports.RuntimeTypeInfoInjector = RuntimeTypeInfoInjector;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVudGltZS1pbmZvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicnVudGltZS1pbmZvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGlDQUFpQztBQUVqQzs7Ozs7Ozs7Ozs7Ozs7R0FjRztBQUNILE1BQWEsdUJBQXVCO0lBR2xDLFlBQW9DLE9BQWU7UUFBZixZQUFPLEdBQVAsT0FBTyxDQUFRO1FBRmxDLGdCQUFXLEdBQUcsSUFBSSxHQUFHLEVBQStCLENBQUM7SUFFaEIsQ0FBQztJQUV2RDs7O09BR0c7SUFDSSxnQkFBZ0IsQ0FBQyxLQUEwQixFQUFFLEdBQVc7UUFDN0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNJLGdCQUFnQjtRQUNyQixPQUFPO1lBQ0wsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7U0FDeEMsQ0FBQztJQUNKLENBQUM7SUFFTSxzQkFBc0I7UUFDM0IsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQ2pCLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRTtnQkFDcEIsTUFBTSxvQkFBb0IsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFFckUsSUFBSSxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7Z0JBQzdCLE1BQU0sT0FBTyxHQUFHLENBQUMsSUFBYSxFQUFXLEVBQUU7b0JBQ3pDLElBQUksRUFBRSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFO3dCQUMvQixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNuQyxJQUFJLEdBQUcsRUFBRTs0QkFDUCxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7NEJBQ3hCLE9BQU8sSUFBSSxDQUFDLHFCQUFxQixDQUMvQixJQUFJLEVBQ0osR0FBRyxFQUNILG9C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c2NyaXB0JztcblxuLyoqXG4gKiBQcm92aWRlcyBhIFRyYW5zZm9ybWVyRmFjdG9yeSB0byBhbm5vdGF0ZSBjbGFzc2VzIHdpdGggcnVudGltZSBpbmZvcm1hdGlvblxuICogKGUuZy4sIGZ1bGx5LXF1YWxpZmllZCBuYW1lLCB2ZXJzaW9uKS5cbiAqXG4gKiBJdCBkb2VzIHRoaXMgYnkgZmlyc3QgaW5zZXJ0aW5nIHRoaXMgZGVmaW5pdGlvbiBhdCB0aGUgdG9wIG9mIGVhY2ggc291cmNlIGZpbGU6XG4gKiBgYGBcbiAqIHZhciBKU0lJX1JUVElfU1lNQk9MXzEgPSBTeW1ib2wuZm9yKFwianNpaS5ydHRpXCIpO1xuICogYGBgXG4gKlxuICogVGhlbiwgZm9yIGVhY2ggY2xhc3MgdGhhdCBoYXMgcmVnaXN0ZXJlZCBydW50aW1lIGluZm9ybWF0aW9uIGR1cmluZyBhc3NlbWJseSxcbiAqIGluc2VydCBhIHN0YXRpYyBtZW1iZXIgdG8gdGhlIGNsYXNzIHdpdGggaXRzIGZxbiBhbmQgdmVyc2lvbjpcbiAqIGBgYFxuICogcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgW0pTSUlfUlRUSV9TWU1CT0xfMV0gPSB7IGZxbjogXCJNb2R1bGVOYW1lLkNsYXNzTmFtZVwiLCB2ZXJzaW9uOiBcIjEuMi4zXCIgfVxuICogYGBgXG4gKi9cbmV4cG9ydCBjbGFzcyBSdW50aW1lVHlwZUluZm9JbmplY3RvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZnFuc0J5Q2xhc3MgPSBuZXcgTWFwPHRzLkNsYXNzRGVjbGFyYXRpb24sIHN0cmluZz4oKTtcblxuICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB2ZXJzaW9uOiBzdHJpbmcpIHt9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIHRoZSBmdWxseS1xdWFsaWZpZWQgbmFtZSAoZnFuKSBvZiBhIGNsYXNzIHdpdGggaXRzIENsYXNzRGVjbGFyYXRpb24uXG4gICAqIE9ubHkgQ2xhc3NEZWNsYXJhdGlvbnMgd2l0aCByZWdpc3RlcmVkIGZxbnMgd2lsbCBiZSBhbm5vdGF0ZWQuXG4gICAqL1xuICBwdWJsaWMgcmVnaXN0ZXJDbGFzc0ZxbihjbGF6ejogdHMuQ2xhc3NEZWNsYXJhdGlvbiwgZnFuOiBzdHJpbmcpIHtcbiAgICB0aGlzLmZxbnNCeUNsYXNzLnNldChjbGF6eiwgZnFuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHNldCBvZiBUcmFuc2Zvcm1lcnMgdG8gYmUgdXNlZCBpbiBUU0MncyBwcm9ncmFtLmVtaXQoKVxuICAgKi9cbiAgcHVibGljIG1ha2VUcmFuc2Zvcm1lcnMoKTogdHMuQ3VzdG9tVHJhbnNmb3JtZXJzIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmVmb3JlOiBbdGhpcy5ydW50aW1lVHlwZVRyYW5zZm9ybWVyKCldLFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgcnVudGltZVR5cGVUcmFuc2Zvcm1lcigpOiB0cy5UcmFuc2Zvcm1lckZhY3Rvcnk8dHMuU291cmNlRmlsZT4ge1xuICAgIHJldHVybiAoY29udGV4dCkgPT4ge1xuICAgICAgcmV0dXJuIChzb3VyY2VGaWxlKSA9PiB7XG4gICAgICAgIGNvbnN0IHJ0dGlTeW1ib2xJZGVudGlmaWVyID0gdHMuY3JlYXRlVW5pcXVlTmFtZSgnSlNJSV9SVFRJX1NZTUJPTCcpO1xuXG4gICAgICAgIGxldCBjbGFzc2VzQW5ub3RhdGVkID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IHZpc2l0b3IgPSAobm9kZTogdHMuTm9kZSk6IHRzLk5vZGUgPT4ge1xuICAgICAgICAgIGlmICh0cy5pc0NsYXNzRGVjbGFyYXRpb24obm9kZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGZxbiA9IHRoaXMuZ2V0Q2xhc3NGcW4obm9kZSk7XG4gICAgICAgICAgICBpZiAoZnFuKSB7XG4gICAgICAgICAgICAgIGNsYXNzZXNBbm5vdGF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRSdW50aW1lSW5mb1RvQ2xhc3MoXG4gICAgICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgICAgICBmcW4sXG4gICAgICAgICAgICAgICAgcnR0aVN5bWJvbElkZW50aWZpZXIsXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cy52aXNpdEVhY2hDaGlsZChub2RlLCB2aXNpdG9yLCBjb250ZXh0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBWaXNpdCB0aGUgc291cmNlIGZpbGUsIGFubm90YXRpbmcgdGhlIGNsYXNzZXMuXG4gICAgICAgIGxldCBhbm5vdGF0ZWRTb3VyY2VGaWxlID0gdHMudmlzaXROb2RlKHNvdXJjZUZpbGUsIHZpc2l0b3IpO1xuXG4gICAgICAgIC8vIE9ubHkgYWRkIHRoZSBzeW1ib2wgZGVmaW5pdGlvbiBpZiBpdCdzIGFjdHVhbGx5IHVzZWQuXG4gICAgICAgIGlmIChjbGFzc2VzQW5ub3RhdGVkKSB7XG4gICAgICAgICAgY29uc3QgcnR0aVN5bWJvbCA9IHRzLmNyZWF0ZUNhbGwoXG4gICAgICAgICAgICB0cy5jcmVhdGVQcm9wZXJ0eUFjY2VzcyhcbiAgICAgICAgICAgICAgdHMuY3JlYXRlSWRlbnRpZmllcignU3ltYm9sJyksXG4gICAgICAgICAgICAgIHRzLmNyZWF0ZUlkZW50aWZpZXIoJ2ZvcicpLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIFt0cy5jcmVhdGVTdHJpbmdMaXRlcmFsKCdqc2lpLnJ0dGknKV0sXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBydHRpU3ltYm9sRGVjbGFyYXRpb24gPSB0cy5jcmVhdGVWYXJpYWJsZURlY2xhcmF0aW9uKFxuICAgICAgICAgICAgcnR0aVN5bWJvbElkZW50aWZpZXIsXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICBydHRpU3ltYm9sLFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgdmFyaWFibGVEZWNsYXJhdGlvbiA9IHRzLmNyZWF0ZVZhcmlhYmxlU3RhdGVtZW50KFxuICAgICAgICAgICAgW10sXG4gICAgICAgICAgICB0cy5jcmVhdGVWYXJpYWJsZURlY2xhcmF0aW9uTGlzdChcbiAgICAgICAgICAgICAgW3J0dGlTeW1ib2xEZWNsYXJhdGlvbl0sXG4gICAgICAgICAgICAgIHRzLk5vZGVGbGFncy5Db25zdCxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGFubm90YXRlZFNvdXJjZUZpbGUgPSB0cy51cGRhdGVTb3VyY2VGaWxlTm9kZShhbm5vdGF0ZWRTb3VyY2VGaWxlLCBbXG4gICAgICAgICAgICB2YXJpYWJsZURlY2xhcmF0aW9uLFxuICAgICAgICAgICAgLi4uYW5ub3RhdGVkU291cmNlRmlsZS5zdGF0ZW1lbnRzLFxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFubm90YXRlZFNvdXJjZUZpbGU7XG4gICAgICB9O1xuICAgIH07XG4gIH1cblxuICAvKiogVXNlZCBpbnN0ZWFkIG9mIGRpcmVjdCBhY2Nlc3MgdG8gdGhlIG1hcCB0byBmYWNpbGlhdGUgdGVzdGluZy4gKi9cbiAgcHJvdGVjdGVkIGdldENsYXNzRnFuKGNsYXp6OiB0cy5DbGFzc0RlY2xhcmF0aW9uKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5mcW5zQnlDbGFzcy5nZXQoY2xhenopO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBDbGFzc0RlY2xhcmF0aW9uIGhhcyBhbiBhc3NvY2lhdGVkIGZ1bGx5LXF1YWxpZmllZCBuYW1lIHJlZ2lzdGVyZWQsXG4gICAqIHdpbGwgYXBwZW5kIGEgc3RhdGljIHByb3BlcnR5IHRvIHRoZSBjbGFzcyB3aXRoIHRoZSBmcW4gYW5kIHZlcnNpb24uXG4gICAqL1xuICBwcml2YXRlIGFkZFJ1bnRpbWVJbmZvVG9DbGFzcyhcbiAgICBub2RlOiB0cy5DbGFzc0RlY2xhcmF0aW9uLFxuICAgIGZxbjogc3RyaW5nLFxuICAgIHJ0dGlTeW1ib2w6IHRzLklkZW50aWZpZXIsXG4gICk6IHRzLkNsYXNzRGVjbGFyYXRpb24ge1xuICAgIGNvbnN0IHJ1bnRpbWVJbmZvID0gdHMuY3JlYXRlT2JqZWN0TGl0ZXJhbChbXG4gICAgICB0cy5jcmVhdGVQcm9wZXJ0eUFzc2lnbm1lbnQoXG4gICAgICAgIHRzLmNyZWF0ZUlkZW50aWZpZXIoJ2ZxbicpLFxuICAgICAgICB0cy5jcmVhdGVTdHJpbmdMaXRlcmFsKGZxbiksXG4gICAgICApLFxuICAgICAgdHMuY3JlYXRlUHJvcGVydHlBc3NpZ25tZW50KFxuICAgICAgICB0cy5jcmVhdGVJZGVudGlmaWVyKCd2ZXJzaW9uJyksXG4gICAgICAgIHRzLmNyZWF0ZVN0cmluZ0xpdGVyYWwodGhpcy52ZXJzaW9uKSxcbiAgICAgICksXG4gICAgXSk7XG4gICAgY29uc3QgcnVudGltZVByb3BlcnR5ID0gdHMuY3JlYXRlUHJvcGVydHkoXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB0cy5jcmVhdGVNb2RpZmllcnNGcm9tTW9kaWZpZXJGbGFncyhcbiAgICAgICAgdHMuTW9kaWZpZXJGbGFncy5Qcml2YXRlIHxcbiAgICAgICAgICB0cy5Nb2RpZmllckZsYWdzLlN0YXRpYyB8XG4gICAgICAgICAgdHMuTW9kaWZpZXJGbGFncy5SZWFkb25seSxcbiAgICAgICksXG4gICAgICB0cy5jcmVhdGVDb21wdXRlZFByb3BlcnR5TmFtZShydHRpU3ltYm9sKSxcbiAgICAgIHVuZGVmaW5lZCxcbiAgICAgIHVuZGVmaW5lZCxcbiAgICAgIHJ1bnRpbWVJbmZvLFxuICAgICk7XG4gICAgcmV0dXJuIHRzLnVwZGF0ZUNsYXNzRGVjbGFyYXRpb24oXG4gICAgICBub2RlLFxuICAgICAgbm9kZS5kZWNvcmF0b3JzLFxuICAgICAgbm9kZS5tb2RpZmllcnMsXG4gICAgICBub2RlLm5hbWUsXG4gICAgICBub2RlLnR5cGVQYXJhbWV0ZXJzLFxuICAgICAgbm9kZS5oZXJpdGFnZUNsYXVzZXMsXG4gICAgICBbcnVudGltZVByb3BlcnR5LCAuLi5ub2RlLm1lbWJlcnNdLFxuICAgICk7XG4gIH1cbn1cbiJdfQ==
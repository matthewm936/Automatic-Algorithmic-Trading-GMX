"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DotNetNameUtils = void 0;
const codemaker_1 = require("codemaker");
const naming_util_1 = require("../../naming-util");
class DotNetNameUtils {
    convertPropertyName(original) {
        if (this.isInvalidName(original)) {
            throw new Error(`Invalid property name: ${original}`);
        }
        return this.capitalizeWord(original);
    }
    convertTypeName(original) {
        if (this.isInvalidName(original)) {
            throw new Error(`Invalid type name: ${original}`);
        }
        return this.capitalizeWord(original);
    }
    convertMethodName(original) {
        if (this.isInvalidName(original)) {
            throw new Error(`Invalid method name: ${original}`);
        }
        return this.capitalizeWord(original);
    }
    convertEnumMemberName(original) {
        if (this.isInvalidName(original)) {
            throw new Error(`Invalid enum member name: ${original}`);
        }
        return this.capitalizeWord(original);
    }
    convertInterfaceName(original) {
        if (this.isInvalidName(original.name)) {
            throw new Error(`Invalid interface name: ${original.name}`);
        }
        if (original.datatype) {
            // Datatype interfaces need to be prefixed by I so that they don't clash with the prop object implementation
            return `I${this.capitalizeWord(original.name)}`;
        }
        // Non datatype interfaces are guaranteed by JSII to be prefixed by I already
        return this.capitalizeWord(original.name);
    }
    convertClassName(original) {
        if (this.isInvalidName(original.name)) {
            throw new Error(`Invalid class name: ${original.name}`);
        }
        // Tentatively get the class name
        let name = this.capitalizeWord(original.name);
        if (original.methods) {
            original.methods.forEach((method) => {
                if (method.name.toLowerCase() === original.name.toLowerCase()) {
                    // This class has a member with the same name, need to slugify the class name
                    name = this.capitalizeWord(this.slugify(original.name));
                }
            });
        }
        if (original.properties) {
            original.properties.forEach((property) => {
                if (property.name.toLowerCase() === original.name.toLowerCase()) {
                    // This class has a member with the same name, need to slugify the class name
                    name = this.capitalizeWord(this.slugify(original.name));
                }
            });
        }
        return name;
    }
    convertPackageName(original) {
        if (this.isInvalidName(original)) {
            throw new Error(`Invalid package name: ${original}`);
        }
        return original
            .split('-')
            .map((s) => this.capitalizeWord(s))
            .join('.');
    }
    convertParameterName(original) {
        if (this.isInvalidName(original)) {
            throw new Error(`Invalid parameter name: ${original}`);
        }
        const name = codemaker_1.toCamelCase(original);
        return this.escapeParameterName(name);
    }
    capitalizeWord(original) {
        return naming_util_1.jsiiToPascalCase(original);
    }
    /* We only want valid names for members */
    isInvalidName(str) {
        // Can not be empty, or contains $
        // Can only start with a letter or an underscore
        return (str === null ||
            /^\s*$/.exec(str) !== null ||
            str.includes('$') ||
            !/^[A-Za-z_]/.exec(str));
    }
    escapeParameterName(name) {
        if (!name) {
            return name;
        }
        if (RESERVED_KEYWORDS.includes(name)) {
            return `@${name}`;
        }
        return name;
    }
    slugify(name) {
        if (!name) {
            return name;
        }
        return `${name}_`;
    }
}
exports.DotNetNameUtils = DotNetNameUtils;
// Pulled from https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/
const RESERVED_KEYWORDS = [
    // For some reason the old generator does not slugify the keyword base?
    'abstract',
    'as',
    'base',
    'bool',
    'break',
    'byte',
    'case',
    'catch',
    'char',
    'checked',
    'class',
    'const',
    'continue',
    'decimal',
    'default',
    'delegate',
    'double',
    'do',
    'else',
    'enum',
    'event',
    'explicit',
    'extern',
    'false',
    'finally',
    'fixed',
    'float',
    'for',
    'foreach',
    'goto',
    'if',
    'implicit',
    'in',
    'int',
    'interface',
    'internal',
    'is',
    'lock',
    'long',
    'namespace',
    'new',
    'null',
    'object',
    'operator',
    'out',
    'override',
    'params',
    'private',
    'protected',
    'public',
    'readonly',
    'ref',
    'return',
    'sbyte',
    'sealed',
    'short',
    'sizeof',
    'stackalloc',
    'static',
    'string',
    'struct',
    'switch',
    'this',
    'throw',
    'true',
    'try',
    'typeof',
    'uint',
    'ulong',
    'unchecked',
    'unsafe',
    'ushort',
    'using',
    'value',
    'virtual',
    'void',
    'volatile',
    'while',
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmFtZXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmFtZXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHlDQUF3QztBQUV4QyxtREFBcUQ7QUFFckQsTUFBYSxlQUFlO0lBQ25CLG1CQUFtQixDQUFDLFFBQWdCO1FBQ3pDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNoQyxNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixRQUFRLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZEO1FBQ0QsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxlQUFlLENBQUMsUUFBZ0I7UUFDckMsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLFFBQVEsRUFBRSxDQUFDLENBQUM7U0FDbkQ7UUFDRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVNLGlCQUFpQixDQUFDLFFBQWdCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNoQyxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixRQUFRLEVBQUUsQ0FBQyxDQUFDO1NBQ3JEO1FBQ0QsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxxQkFBcUIsQ0FBQyxRQUFnQjtRQUMzQyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDaEMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsUUFBUSxFQUFFLENBQUMsQ0FBQztTQUMxRDtRQUNELE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRU0sb0JBQW9CLENBQUMsUUFB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SixLQUFLO0lBQ0wsV0FBVztJQUNYLFVBQVU7SUFDVixJQUFJO0lBQ0osTUFBTTtJQUNOLE1BQU07SUFDTixXQUFXO0lBQ1gsS0FBSztJQUNMLE1BQU07SUFDTixRQUFRO0lBQ1IsVUFBVTtJQUNWLEtBQUs7SUFDTCxVQUFVO0lBQ1YsUUFBUTtJQUNSLFNBQVM7SUFDVCxXQUFXO0lBQ1gsUUFBUTtJQUNSLFVBQVU7SUFDVixLQUFLO0lBQ0wsUUFBUTtJQUNSLE9BQU87SUFDUCxRQUFRO0lBQ1IsT0FBTztJQUNQLFFBQVE7SUFDUixZQUFZO0lBQ1osUUFBUTtJQUNSLFFBQVE7SUFDUixRQUFRO0lBQ1IsUUFBUTtJQUNSLE1BQU07SUFDTixPQUFPO0lBQ1AsTUFBTTtJQUNOLEtBQUs7SUFDTCxRQUFRO0lBQ1IsTUFBTTtJQUNOLE9BQU87SUFDUCxXQUFXO0lBQ1gsUUFBUTtJQUNSLFFBQVE7SUFDUixPQUFPO0lBQ1AsT0FBTztJQUNQLFNBQVM7SUFDVCxNQUFNO0lBQ04sVUFBVTtJQUNWLE9BQU87Q0FDUixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgc3BlYyBmcm9tICdAanNpaS9zcGVjJztcbmltcG9ydCB7IHRvQ2FtZWxDYXNlIH0gZnJvbSAnY29kZW1ha2VyJztcblxuaW1wb3J0IHsganNpaVRvUGFzY2FsQ2FzZSB9IGZyb20gJy4uLy4uL25hbWluZy11dGlsJztcblxuZXhwb3J0IGNsYXNzIERvdE5ldE5hbWVVdGlscyB7XG4gIHB1YmxpYyBjb252ZXJ0UHJvcGVydHlOYW1lKG9yaWdpbmFsOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5pc0ludmFsaWROYW1lKG9yaWdpbmFsKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHByb3BlcnR5IG5hbWU6ICR7b3JpZ2luYWx9YCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNhcGl0YWxpemVXb3JkKG9yaWdpbmFsKTtcbiAgfVxuXG4gIHB1YmxpYyBjb252ZXJ0VHlwZU5hbWUob3JpZ2luYWw6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzSW52YWxpZE5hbWUob3JpZ2luYWwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdHlwZSBuYW1lOiAke29yaWdpbmFsfWApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jYXBpdGFsaXplV29yZChvcmlnaW5hbCk7XG4gIH1cblxuICBwdWJsaWMgY29udmVydE1ldGhvZE5hbWUob3JpZ2luYWw6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzSW52YWxpZE5hbWUob3JpZ2luYWwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWV0aG9kIG5hbWU6ICR7b3JpZ2luYWx9YCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNhcGl0YWxpemVXb3JkKG9yaWdpbmFsKTtcbiAgfVxuXG4gIHB1YmxpYyBjb252ZXJ0RW51bU1lbWJlck5hbWUob3JpZ2luYWw6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzSW52YWxpZE5hbWUob3JpZ2luYWwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZW51bSBtZW1iZXIgbmFtZTogJHtvcmlnaW5hbH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY2FwaXRhbGl6ZVdvcmQob3JpZ2luYWwpO1xuICB9XG5cbiAgcHVibGljIGNvbnZlcnRJbnRlcmZhY2VOYW1lKG9yaWdpbmFsOiBzcGVjLkludGVyZmFjZVR5cGUpIHtcbiAgICBpZiAodGhpcy5pc0ludmFsaWROYW1lKG9yaWdpbmFsLm5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgaW50ZXJmYWNlIG5hbWU6ICR7b3JpZ2luYWwubmFtZX1gKTtcbiAgICB9XG4gICAgaWYgKG9yaWdpbmFsLmRhdGF0eXBlKSB7XG4gICAgICAvLyBEYXRhdHlwZSBpbnRlcmZhY2VzIG5lZWQgdG8gYmUgcHJlZml4ZWQgYnkgSSBzbyB0aGF0IHRoZXkgZG9uJ3QgY2xhc2ggd2l0aCB0aGUgcHJvcCBvYmplY3QgaW1wbGVtZW50YXRpb25cbiAgICAgIHJldHVybiBgSSR7dGhpcy5jYXBpdGFsaXplV29yZChvcmlnaW5hbC5uYW1lKX1gO1xuICAgIH1cbiAgICAvLyBOb24gZGF0YXR5cGUgaW50ZXJmYWNlcyBhcmUgZ3VhcmFudGVlZCBieSBKU0lJIHRvIGJlIHByZWZpeGVkIGJ5IEkgYWxyZWFkeVxuICAgIHJldHVybiB0aGlzLmNhcGl0YWxpemVXb3JkKG9yaWdpbmFsLm5hbWUpO1xuICB9XG5cbiAgcHVibGljIGNvbnZlcnRDbGFzc05hbWUob3JpZ2luYWw6IHNwZWMuQ2xhc3NUeXBlIHwgc3BlYy5JbnRlcmZhY2VUeXBlKSB7XG4gICAgaWYgKHRoaXMuaXNJbnZhbGlkTmFtZShvcmlnaW5hbC5uYW1lKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNsYXNzIG5hbWU6ICR7b3JpZ2luYWwubmFtZX1gKTtcbiAgICB9XG4gICAgLy8gVGVudGF0aXZlbHkgZ2V0IHRoZSBjbGFzcyBuYW1lXG4gICAgbGV0IG5hbWUgPSB0aGlzLmNhcGl0YWxpemVXb3JkKG9yaWdpbmFsLm5hbWUpO1xuICAgIGlmIChvcmlnaW5hbC5tZXRob2RzKSB7XG4gICAgICBvcmlnaW5hbC5tZXRob2RzLmZvckVhY2goKG1ldGhvZCkgPT4ge1xuICAgICAgICBpZiAobWV0aG9kLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gb3JpZ2luYWwubmFtZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgLy8gVGhpcyBjbGFzcyBoYXMgYSBtZW1iZXIgd2l0aCB0aGUgc2FtZSBuYW1lLCBuZWVkIHRvIHNsdWdpZnkgdGhlIGNsYXNzIG5hbWVcbiAgICAgICAgICBuYW1lID0gdGhpcy5jYXBpdGFsaXplV29yZCh0aGlzLnNsdWdpZnkob3JpZ2luYWwubmFtZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG9yaWdpbmFsLnByb3BlcnRpZXMpIHtcbiAgICAgIG9yaWdpbmFsLnByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHkpID0+IHtcbiAgICAgICAgaWYgKHByb3BlcnR5Lm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gb3JpZ2luYWwubmFtZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgLy8gVGhpcyBjbGFzcyBoYXMgYSBtZW1iZXIgd2l0aCB0aGUgc2FtZSBuYW1lLCBuZWVkIHRvIHNsdWdpZnkgdGhlIGNsYXNzIG5hbWVcbiAgICAgICAgICBuYW1lID0gdGhpcy5jYXBpdGFsaXplV29yZCh0aGlzLnNsdWdpZnkob3JpZ2luYWwubmFtZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmFtZTtcbiAgfVxuXG4gIHB1YmxpYyBjb252ZXJ0UGFja2FnZU5hbWUob3JpZ2luYWw6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzSW52YWxpZE5hbWUob3JpZ2luYWwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcGFja2FnZSBuYW1lOiAke29yaWdpbmFsfWApO1xuICAgIH1cbiAgICByZXR1cm4gb3JpZ2luYWxcbiAgICAgIC5zcGxpdCgnLScpXG4gICAgICAubWFwKChzOiBzdHJpbmcpID0+IHRoaXMuY2FwaXRhbGl6ZVdvcmQocykpXG4gICAgICAuam9pbignLicpO1xuICB9XG5cbiAgcHVibGljIGNvbnZlcnRQYXJhbWV0ZXJOYW1lKG9yaWdpbmFsOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5pc0ludmFsaWROYW1lKG9yaWdpbmFsKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhcmFtZXRlciBuYW1lOiAke29yaWdpbmFsfWApO1xuICAgIH1cbiAgICBjb25zdCBuYW1lID0gdG9DYW1lbENhc2Uob3JpZ2luYWwpO1xuICAgIHJldHVybiB0aGlzLmVzY2FwZVBhcmFtZXRlck5hbWUobmFtZSk7XG4gIH1cblxuICBwdWJsaWMgY2FwaXRhbGl6ZVdvcmQob3JpZ2luYWw6IHN0cmluZykge1xuICAgIHJldHVybiBqc2lpVG9QYXNjYWxDYXNlKG9yaWdpbmFsKTtcbiAgfVxuXG4gIC8qIFdlIG9ubHkgd2FudCB2YWxpZCBuYW1lcyBmb3IgbWVtYmVycyAqL1xuICBwcml2YXRlIGlzSW52YWxpZE5hbWUoc3RyOiBzdHJpbmcpIHtcbiAgICAvLyBDYW4gbm90IGJlIGVtcHR5LCBvciBjb250YWlucyAkXG4gICAgLy8gQ2FuIG9ubHkgc3RhcnQgd2l0aCBhIGxldHRlciBvciBhbiB1bmRlcnNjb3JlXG4gICAgcmV0dXJuIChcbiAgICAgIHN0ciA9PT0gbnVsbCB8fFxuICAgICAgL15cXHMqJC8uZXhlYyhzdHIpICE9PSBudWxsIHx8XG4gICAgICBzdHIuaW5jbHVkZXMoJyQnKSB8fFxuICAgICAgIS9eW0EtWmEtel9dLy5leGVjKHN0cilcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBlc2NhcGVQYXJhbWV0ZXJOYW1lKG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICByZXR1cm4gbmFtZTtcbiAgICB9XG4gICAgaWYgKFJFU0VSVkVEX0tFWVdPUkRTLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICByZXR1cm4gYEAke25hbWV9YDtcbiAgICB9XG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICBwcml2YXRlIHNsdWdpZnkobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiBuYW1lO1xuICAgIH1cbiAgICByZXR1cm4gYCR7bmFtZX1fYDtcbiAgfVxufVxuXG4vLyBQdWxsZWQgZnJvbSBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9kb3RuZXQvY3NoYXJwL2xhbmd1YWdlLXJlZmVyZW5jZS9rZXl3b3Jkcy9cbmNvbnN0IFJFU0VSVkVEX0tFWVdPUkRTID0gW1xuICAvLyBGb3Igc29tZSByZWFzb24gdGhlIG9sZCBnZW5lcmF0b3IgZG9lcyBub3Qgc2x1Z2lmeSB0aGUga2V5d29yZCBiYXNlP1xuICAnYWJzdHJhY3QnLFxuICAnYXMnLFxuICAnYmFzZScsXG4gICdib29sJyxcbiAgJ2JyZWFrJyxcbiAgJ2J5dGUnLFxuICAnY2FzZScsXG4gICdjYXRjaCcsXG4gICdjaGFyJyxcbiAgJ2NoZWNrZWQnLFxuICAnY2xhc3MnLFxuICAnY29uc3QnLFxuICAnY29udGludWUnLFxuICAnZGVjaW1hbCcsXG4gICdkZWZhdWx0JyxcbiAgJ2RlbGVnYXRlJyxcbiAgJ2RvdWJsZScsXG4gICdkbycsXG4gICdlbHNlJyxcbiAgJ2VudW0nLFxuICAnZXZlbnQnLFxuICAnZXhwbGljaXQnLFxuICAnZXh0ZXJuJyxcbiAgJ2ZhbHNlJyxcbiAgJ2ZpbmFsbHknLFxuICAnZml4ZWQnLFxuICAnZmxvYXQnLFxuICAnZm9yJyxcbiAgJ2ZvcmVhY2gnLFxuICAnZ290bycsXG4gICdpZicsXG4gICdpbXBsaWNpdCcsXG4gICdpbicsXG4gICdpbnQnLFxuICAnaW50ZXJmYWNlJyxcbiAgJ2ludGVybmFsJyxcbiAgJ2lzJyxcbiAgJ2xvY2snLFxuICAnbG9uZycsXG4gICduYW1lc3BhY2UnLFxuICAnbmV3JyxcbiAgJ251bGwnLFxuICAnb2JqZWN0JyxcbiAgJ29wZXJhdG9yJyxcbiAgJ291dCcsXG4gICdvdmVycmlkZScsXG4gICdwYXJhbXMnLFxuICAncHJpdmF0ZScsXG4gICdwcm90ZWN0ZWQnLFxuICAncHVibGljJyxcbiAgJ3JlYWRvbmx5JyxcbiAgJ3JlZicsXG4gICdyZXR1cm4nLFxuICAnc2J5dGUnLFxuICAnc2VhbGVkJyxcbiAgJ3Nob3J0JyxcbiAgJ3NpemVvZicsXG4gICdzdGFja2FsbG9jJyxcbiAgJ3N0YXRpYycsXG4gICdzdHJpbmcnLFxuICAnc3RydWN0JyxcbiAgJ3N3aXRjaCcsXG4gICd0aGlzJyxcbiAgJ3Rocm93JyxcbiAgJ3RydWUnLFxuICAndHJ5JyxcbiAgJ3R5cGVvZicsXG4gICd1aW50JyxcbiAgJ3Vsb25nJyxcbiAgJ3VuY2hlY2tlZCcsXG4gICd1bnNhZmUnLFxuICAndXNob3J0JyxcbiAgJ3VzaW5nJyxcbiAgJ3ZhbHVlJyxcbiAgJ3ZpcnR1YWwnLFxuICAndm9pZCcsXG4gICd2b2xhdGlsZScsXG4gICd3aGlsZScsXG5dO1xuIl19
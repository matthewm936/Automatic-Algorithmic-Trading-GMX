"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DotNetRuntimeGenerator = void 0;
const spec = require("@jsii/spec");
const nameutils_1 = require("./nameutils");
/**
 * Generates the Jsii attributes and calls for the jsii .NET runtime
 *
 * Uses the same instance of CodeMaker as the rest of the code
 */
class DotNetRuntimeGenerator {
    constructor(code, typeresolver) {
        this.nameutils = new nameutils_1.DotNetNameUtils();
        this.code = code;
        this.typeresolver = typeresolver;
    }
    /**
     * Emits the jsii attribute for an interface
     *
     * Ex: [JsiiInterface(nativeType: typeof(IGreetee), fullyQualifiedName: "jsii-calc.Greetee")]
     */
    emitAttributesForInterface(ifc) {
        const jsiiAttribute = `[JsiiInterface(nativeType: typeof(${this.nameutils.convertInterfaceName(ifc)}), fullyQualifiedName: "${ifc.fqn}")]`;
        this.code.line(jsiiAttribute);
        this.emitDeprecatedAttributeIfNecessary(ifc);
    }
    /**
     * Emits the jsii attribute for an interface datatype
     *
     * @param ifc the annotated interface type.
     *
     * Ex: [JsiiByValue(fqn: "assembly.TypeName")]
     */
    emitAttributesForInterfaceDatatype(ifc) {
        const jsiiAttribute = `[JsiiByValue(fqn: "${ifc.fqn}")]`;
        this.code.line(jsiiAttribute);
    }
    /**
     * Emits the jsii attribute for a class
     *
     * Ex: [JsiiClass(nativeType: typeof(Very), fullyQualifiedName: "@scope/jsii-calc-base-of-base.Very")]
     */
    emitAttributesForClass(cls) {
        // const className = this.nameutils.convertClassName(cls);
        const className = this.typeresolver.toNativeFqn(cls.fqn);
        let jsiiAttribute = `[JsiiClass(nativeType: typeof(${className}), fullyQualifiedName: "${cls.fqn}")]`;
        const initializer = cls.initializer;
        if (initializer) {
            if (initializer.parameters) {
                jsiiAttribute =
                    `[JsiiClass(nativeType: typeof(${className}), fullyQualifiedName: ` +
                        `"${cls.fqn}", parametersJson: "${JSON.stringify(initializer.parameters)
                            .replace(/"/g, '\\"')
                            .replace(/\\{2}"/g, 'test')}")]`;
            }
        }
        this.code.line(jsiiAttribute);
        this.emitDeprecatedAttributeIfNecessary(cls);
    }
    /**
     * Emits the proper jsii .NET attribute for a method
     *
     * Ex: [JsiiMethod(name: "hey", returnsJson: "{\"type\":{\"primitive\":\"number\"}}")
     */
    emitAttributesForMethod(cls, method /*, emitForProxyOrDatatype: boolean = false*/) {
        const isOverride = spec.isClassType(cls) && method.overrides ? ', isOverride: true' : '';
        const isAsync = spec.isClassType(cls) && method.async ? ', isAsync: true' : '';
        const parametersJson = method.parameters
            ? `, parametersJson: "${JSON.stringify(method.parameters)
                .replace(/"/g, '\\"')
                .replace(/\\{2}"/g, 'test')}"`
            : '';
        const returnsJson = method.returns
            ? `, returnsJson: "${JSON.stringify(method.returns)
                .replace(/"/g, '\\"')
                .replace(/\\{2}"/g, 'test')}"`
            : '';
        const jsiiAttribute = `[JsiiMethod(name: "${method.name}"${returnsJson}${parametersJson}${isAsync}${isOverride})]`;
        this.code.line(jsiiAttribute);
        this.emitDeprecatedAttributeIfNecessary(method);
    }
    /**
     * Emits the proper jsii .NET attribute for a property
     *
     * Ex: [JsiiProperty(name: "foo", typeJson: "{\"fqn\":\"@scope/jsii-calc-base-of-base.Very\"}", isOptional: true, isOverride: true)]
     */
    emitAttributesForProperty(prop, datatype = false) {
        // If we are on a datatype then we want the property to override in Jsii
        const isJsiiOverride = datatype ? ', isOverride: true' : '';
        const isOptionalJsii = prop.optional ? ', isOptional: true' : '';
        const jsiiAttribute = `[JsiiProperty(name: "${prop.name}", ` +
            `typeJson: "${JSON.stringify(prop.type)
                .replace(/"/g, '\\"')
                .replace(/\\{2}"/g, 'test')}"${isOptionalJsii}${isJsiiOverride})]`;
        this.code.line(jsiiAttribute);
        this.emitDeprecatedAttributeIfNecessary(prop);
    }
    /**
     * Emits the proper jsii .NET attribute for an interface proxy
     *
     * Ex: [JsiiTypeProxy(nativeType: typeof(IVeryBaseProps), fullyQualifiedName: "@scope/jsii-calc-base-of-base.VeryBaseProps")]
     */
    emitAttributesForInterfaceProxy(ifc) {
        const name = spec.isInterfaceType(ifc)
            ? this.nameutils.convertInterfaceName(ifc)
            : this.typeresolver.toNativeFqn(ifc.fqn);
        this.code.line(`[JsiiTypeProxy(nativeType: typeof(${name}), fullyQualifiedName: "${ifc.fqn}")]`);
        this.emitDeprecatedAttributeIfNecessary(ifc);
    }
    /**
     * Emits the proper jsii .NET attribute for an enum
     *
     * Ex: [JsiiEnum(nativeType: typeof(Test), fullyQualifiedName: "jsii-calc.Test")]
     */
    emitAttributesForEnum(enm, enumName) {
        const jsiiAttribute = `[JsiiEnum(nativeType: typeof(${enumName}), fullyQualifiedName: "${enm.fqn}")]`;
        this.code.line(jsiiAttribute);
        this.emitDeprecatedAttributeIfNecessary(enm);
    }
    /**
     * Emits the proper jsii .NET attribute for an enum member
     *
     * Ex: [JsiiEnumMember(name: "Normal")]
     */
    emitAttributesForEnumMember(enumMemberName, enmmember) {
        const jsiiAttribute = `[JsiiEnumMember(name: "${enumMemberName}")]`;
        this.code.line(jsiiAttribute);
        this.emitDeprecatedAttributeIfNecessary(enmmember);
    }
    /**
     * Returns the jsii .NET method identifier
     */
    createInvokeMethodIdentifier(method, cls) {
        var _a;
        const className = this.typeresolver.toNativeFqn(cls.fqn);
        const isStatic = method.static ? 'Static' : 'Instance';
        const returns = method.returns ? '' : 'Void';
        const invokeMethodName = method.returns
            ? `return Invoke${isStatic}${returns}Method`
            : `Invoke${isStatic}${returns}Method`;
        const returnType = method.returns
            ? `<${this.typeresolver.toDotNetType(method.returns.type)}${method.returns.optional ? '?' : ''}>`
            : '';
        // If the method returns a non-optional value, apply a "!" to silence compilation warning.
        const bang = method.returns && !method.returns.optional ? '!' : '';
        const typeofStatement = method.static ? `typeof(${className}), ` : '';
        const paramTypes = new Array();
        const params = new Array();
        if (method.parameters) {
            for (const param of method.parameters) {
                paramTypes.push(`typeof(${this.typeresolver.toDotNetType(param.type)}${param.variadic ? '[]' : ''})`);
                params.push(this.nameutils.convertParameterName(param.name));
            }
        }
        const hasOptional = ((_a = method.parameters) === null || _a === void 0 ? void 0 : _a.find((param) => param.optional)) != null ? '?' : '';
        return `${invokeMethodName}${returnType}(${typeofStatement}new System.Type[]{${paramTypes.join(', ')}}, new object${hasOptional}[]{${params.join(', ')}})${bang};`;
    }
    /**
     * Emits the proper .NET attribute for a deprecated class/interface/member
     *
     * Ex: [System.Obsolete()]
     */
    emitDeprecatedAttributeIfNecessary(obj) {
        if (!obj) {
            return;
        }
        const docs = obj.docs;
        if (docs) {
            if (docs.stability === spec.Stability.Deprecated) {
                const attribute = docs.deprecated
                    ? `[System.Obsolete("${docs.deprecated
                        .replace(/\n/g, ' ') // Replacing new lines in Obsolete
                        .replace(/"/g, '\\"')}")]`
                    : '[System.Obsolete()]';
                this.code.line(attribute);
            }
        }
    }
}
exports.DotNetRuntimeGenerator = DotNetRuntimeGenerator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG90bmV0cnVudGltZWdlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRvdG5ldHJ1bnRpbWVnZW5lcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbUNBQW1DO0FBSW5DLDJDQUE4QztBQUU5Qzs7OztHQUlHO0FBQ0gsTUFBYSxzQkFBc0I7SUFLakMsWUFBbUIsSUFBZSxFQUFFLFlBQWdDO1FBRm5ELGNBQVMsR0FBb0IsSUFBSSwyQkFBZSxFQUFFLENBQUM7UUFHbEUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDbkMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSwwQkFBMEIsQ0FBQyxHQUF1QjtRQUN2RCxNQUFNLGFBQWEsR0FBRyxxQ0FBcUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsQ0FDNUYsR0FBRyxDQUNKLDJCQUEyQixHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSSxrQ0FBa0MsQ0FBQyxHQUF1QjtRQUMvRCxNQUFNLGFBQWEsR0FBRyxzQkFBc0IsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQ3pELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksc0JBQXNCLENBQUMsR0FBbUI7UUFDL0MsMERBQTBEO1FBQzFELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6RCxJQUFJLGFBQWEsR0FBRyxpQ0FBaUMsU0FBUywyQkFBMkIsR0FB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S0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLGtDQUFrQzt5QkFDdEQsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsS0FBSztvQkFDOUIsQ0FBQyxDQUFDLHFCQUFxQixDQUFDO2dCQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQzthQUMzQjtTQUNGO0lBQ0gsQ0FBQztDQUNGO0FBOU5ELHdEQThOQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHNwZWMgZnJvbSAnQGpzaWkvc3BlYyc7XG5pbXBvcnQgeyBDb2RlTWFrZXIgfSBmcm9tICdjb2RlbWFrZXInO1xuXG5pbXBvcnQgeyBEb3ROZXRUeXBlUmVzb2x2ZXIgfSBmcm9tICcuL2RvdG5ldHR5cGVyZXNvbHZlcic7XG5pbXBvcnQgeyBEb3ROZXROYW1lVXRpbHMgfSBmcm9tICcuL25hbWV1dGlscyc7XG5cbi8qKlxuICogR2VuZXJhdGVzIHRoZSBKc2lpIGF0dHJpYnV0ZXMgYW5kIGNhbGxzIGZvciB0aGUganNpaSAuTkVUIHJ1bnRpbWVcbiAqXG4gKiBVc2VzIHRoZSBzYW1lIGluc3RhbmNlIG9mIENvZGVNYWtlciBhcyB0aGUgcmVzdCBvZiB0aGUgY29kZVxuICovXG5leHBvcnQgY2xhc3MgRG90TmV0UnVudGltZUdlbmVyYXRvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29kZTogQ29kZU1ha2VyO1xuICBwcml2YXRlIHJlYWRvbmx5IHR5cGVyZXNvbHZlcjogRG90TmV0VHlwZVJlc29sdmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IG5hbWV1dGlsczogRG90TmV0TmFtZVV0aWxzID0gbmV3IERvdE5ldE5hbWVVdGlscygpO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihjb2RlOiBDb2RlTWFrZXIsIHR5cGVyZXNvbHZlcjogRG90TmV0VHlwZVJlc29sdmVyKSB7XG4gICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICB0aGlzLnR5cGVyZXNvbHZlciA9IHR5cGVyZXNvbHZlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUganNpaSBhdHRyaWJ1dGUgZm9yIGFuIGludGVyZmFjZVxuICAgKlxuICAgKiBFeDogW0pzaWlJbnRlcmZhY2UobmF0aXZlVHlwZTogdHlwZW9mKElHcmVldGVlKSwgZnVsbHlRdWFsaWZpZWROYW1lOiBcImpzaWktY2FsYy5HcmVldGVlXCIpXVxuICAgKi9cbiAgcHVibGljIGVtaXRBdHRyaWJ1dGVzRm9ySW50ZXJmYWNlKGlmYzogc3BlYy5JbnRlcmZhY2VUeXBlKSB7XG4gICAgY29uc3QganNpaUF0dHJpYnV0ZSA9IGBbSnNpaUludGVyZmFjZShuYXRpdmVUeXBlOiB0eXBlb2YoJHt0aGlzLm5hbWV1dGlscy5jb252ZXJ0SW50ZXJmYWNlTmFtZShcbiAgICAgIGlmYyxcbiAgICApfSksIGZ1bGx5UXVhbGlmaWVkTmFtZTogXCIke2lmYy5mcW59XCIpXWA7XG4gICAgdGhpcy5jb2RlLmxpbmUoanNpaUF0dHJpYnV0ZSk7XG4gICAgdGhpcy5lbWl0RGVwcmVjYXRlZEF0dHJpYnV0ZUlmTmVjZXNzYXJ5KGlmYyk7XG4gIH1cblxuICAvKipcbiAgICogRW1pdHMgdGhlIGpzaWkgYXR0cmlidXRlIGZvciBhbiBpbnRlcmZhY2UgZGF0YXR5cGVcbiAgICpcbiAgICogQHBhcmFtIGlmYyB0aGUgYW5ub3RhdGVkIGludGVyZmFjZSB0eXBlLlxuICAgKlxuICAgKiBFeDogW0pzaWlCeVZhbHVlKGZxbjogXCJhc3NlbWJseS5UeXBlTmFtZVwiKV1cbiAgICovXG4gIHB1YmxpYyBlbWl0QXR0cmlidXRlc0ZvckludGVyZmFjZURhdGF0eXBlKGlmYzogc3BlYy5JbnRlcmZhY2VUeXBlKSB7XG4gICAgY29uc3QganNpaUF0dHJpYnV0ZSA9IGBbSnNpaUJ5VmFsdWUoZnFuOiBcIiR7aWZjLmZxbn1cIildYDtcbiAgICB0aGlzLmNvZGUubGluZShqc2lpQXR0cmlidXRlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUganNpaSBhdHRyaWJ1dGUgZm9yIGEgY2xhc3NcbiAgICpcbiAgICogRXg6IFtKc2lpQ2xhc3MobmF0aXZlVHlwZTogdHlwZW9mKFZlcnkpLCBmdWxseVF1YWxpZmllZE5hbWU6IFwiQHNjb3BlL2pzaWktY2FsYy1iYXNlLW9mLWJhc2UuVmVyeVwiKV1cbiAgICovXG4gIHB1YmxpYyBlbWl0QXR0cmlidXRlc0ZvckNsYXNzKGNsczogc3BlYy5DbGFzc1R5cGUpIHtcbiAgICAvLyBjb25zdCBjbGFzc05hbWUgPSB0aGlzLm5hbWV1dGlscy5jb252ZXJ0Q2xhc3NOYW1lKGNscyk7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy50eXBlcmVzb2x2ZXIudG9OYXRpdmVGcW4oY2xzLmZxbik7XG4gICAgbGV0IGpzaWlBdHRyaWJ1dGUgPSBgW0pzaWlDbGFzcyhuYXRpdmVUeXBlOiB0eXBlb2YoJHtjbGFzc05hbWV9KSwgZnVsbHlRdWFsaWZpZWROYW1lOiBcIiR7Y2xzLmZxbn1cIildYDtcbiAgICBjb25zdCBpbml0aWFsaXplciA9IGNscy5pbml0aWFsaXplcjtcbiAgICBpZiAoaW5pdGlhbGl6ZXIpIHtcbiAgICAgIGlmIChpbml0aWFsaXplci5wYXJhbWV0ZXJzKSB7XG4gICAgICAgIGpzaWlBdHRyaWJ1dGUgPVxuICAgICAgICAgIGBbSnNpaUNsYXNzKG5hdGl2ZVR5cGU6IHR5cGVvZigke2NsYXNzTmFtZX0pLCBmdWxseVF1YWxpZmllZE5hbWU6IGAgK1xuICAgICAgICAgIGBcIiR7Y2xzLmZxbn1cIiwgcGFyYW1ldGVyc0pzb246IFwiJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgIGluaXRpYWxpemVyLnBhcmFtZXRlcnMsXG4gICAgICAgICAgKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcXFx7Mn1cIi9nLCAndGVzdCcpfVwiKV1gO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmNvZGUubGluZShqc2lpQXR0cmlidXRlKTtcbiAgICB0aGlzLmVtaXREZXByZWNhdGVkQXR0cmlidXRlSWZOZWNlc3NhcnkoY2xzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUgcHJvcGVyIGpzaWkgLk5FVCBhdHRyaWJ1dGUgZm9yIGEgbWV0aG9kXG4gICAqXG4gICAqIEV4OiBbSnNpaU1ldGhvZChuYW1lOiBcImhleVwiLCByZXR1cm5zSnNvbjogXCJ7XFxcInR5cGVcXFwiOntcXFwicHJpbWl0aXZlXFxcIjpcXFwibnVtYmVyXFxcIn19XCIpXG4gICAqL1xuICBwdWJsaWMgZW1pdEF0dHJpYnV0ZXNGb3JNZXRob2QoXG4gICAgY2xzOiBzcGVjLkNsYXNzVHlwZSB8IHNwZWMuSW50ZXJmYWNlVHlwZSxcbiAgICBtZXRob2Q6IHNwZWMuTWV0aG9kIC8qLCBlbWl0Rm9yUHJveHlPckRhdGF0eXBlOiBib29sZWFuID0gZmFsc2UqLyxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgaXNPdmVycmlkZSA9XG4gICAgICBzcGVjLmlzQ2xhc3NUeXBlKGNscykgJiYgbWV0aG9kLm92ZXJyaWRlcyA/ICcsIGlzT3ZlcnJpZGU6IHRydWUnIDogJyc7XG4gICAgY29uc3QgaXNBc3luYyA9XG4gICAgICBzcGVjLmlzQ2xhc3NUeXBlKGNscykgJiYgbWV0aG9kLmFzeW5jID8gJywgaXNBc3luYzogdHJ1ZScgOiAnJztcbiAgICBjb25zdCBwYXJhbWV0ZXJzSnNvbiA9IG1ldGhvZC5wYXJhbWV0ZXJzXG4gICAgICA/IGAsIHBhcmFtZXRlcnNKc29uOiBcIiR7SlNPTi5zdHJpbmdpZnkobWV0aG9kLnBhcmFtZXRlcnMpXG4gICAgICAgICAgLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKVxuICAgICAgICAgIC5yZXBsYWNlKC9cXFxcezJ9XCIvZywgJ3Rlc3QnKX1cImBcbiAgICAgIDogJyc7XG4gICAgY29uc3QgcmV0dXJuc0pzb24gPSBtZXRob2QucmV0dXJuc1xuICAgICAgPyBgLCByZXR1cm5zSnNvbjogXCIke0pTT04uc3RyaW5naWZ5KG1ldGhvZC5yZXR1cm5zKVxuICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCAnXFxcXFwiJylcbiAgICAgICAgICAucmVwbGFjZSgvXFxcXHsyfVwiL2csICd0ZXN0Jyl9XCJgXG4gICAgICA6ICcnO1xuICAgIGNvbnN0IGpzaWlBdHRyaWJ1dGUgPSBgW0pzaWlNZXRob2QobmFtZTogXCIke21ldGhvZC5uYW1lfVwiJHtyZXR1cm5zSnNvbn0ke3BhcmFtZXRlcnNKc29ufSR7aXNBc3luY30ke2lzT3ZlcnJpZGV9KV1gO1xuICAgIHRoaXMuY29kZS5saW5lKGpzaWlBdHRyaWJ1dGUpO1xuICAgIHRoaXMuZW1pdERlcHJlY2F0ZWRBdHRyaWJ1dGVJZk5lY2Vzc2FyeShtZXRob2QpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIHRoZSBwcm9wZXIganNpaSAuTkVUIGF0dHJpYnV0ZSBmb3IgYSBwcm9wZXJ0eVxuICAgKlxuICAgKiBFeDogW0pzaWlQcm9wZXJ0eShuYW1lOiBcImZvb1wiLCB0eXBlSnNvbjogXCJ7XFxcImZxblxcXCI6XFxcIkBzY29wZS9qc2lpLWNhbGMtYmFzZS1vZi1iYXNlLlZlcnlcXFwifVwiLCBpc09wdGlvbmFsOiB0cnVlLCBpc092ZXJyaWRlOiB0cnVlKV1cbiAgICovXG4gIHB1YmxpYyBlbWl0QXR0cmlidXRlc0ZvclByb3BlcnR5KFxuICAgIHByb3A6IHNwZWMuUHJvcGVydHksXG4gICAgZGF0YXR5cGUgPSBmYWxzZSxcbiAgKTogdm9pZCB7XG4gICAgLy8gSWYgd2UgYXJlIG9uIGEgZGF0YXR5cGUgdGhlbiB3ZSB3YW50IHRoZSBwcm9wZXJ0eSB0byBvdmVycmlkZSBpbiBKc2lpXG4gICAgY29uc3QgaXNKc2lpT3ZlcnJpZGUgPSBkYXRhdHlwZSA/ICcsIGlzT3ZlcnJpZGU6IHRydWUnIDogJyc7XG4gICAgY29uc3QgaXNPcHRpb25hbEpzaWkgPSBwcm9wLm9wdGlvbmFsID8gJywgaXNPcHRpb25hbDogdHJ1ZScgOiAnJztcbiAgICBjb25zdCBqc2lpQXR0cmlidXRlID1cbiAgICAgIGBbSnNpaVByb3BlcnR5KG5hbWU6IFwiJHtwcm9wLm5hbWV9XCIsIGAgK1xuICAgICAgYHR5cGVKc29uOiBcIiR7SlNPTi5zdHJpbmdpZnkocHJvcC50eXBlKVxuICAgICAgICAucmVwbGFjZSgvXCIvZywgJ1xcXFxcIicpXG4gICAgICAgIC5yZXBsYWNlKC9cXFxcezJ9XCIvZywgJ3Rlc3QnKX1cIiR7aXNPcHRpb25hbEpzaWl9JHtpc0pzaWlPdmVycmlkZX0pXWA7XG4gICAgdGhpcy5jb2RlLmxpbmUoanNpaUF0dHJpYnV0ZSk7XG4gICAgdGhpcy5lbWl0RGVwcmVjYXRlZEF0dHJpYnV0ZUlmTmVjZXNzYXJ5KHByb3ApO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIHRoZSBwcm9wZXIganNpaSAuTkVUIGF0dHJpYnV0ZSBmb3IgYW4gaW50ZXJmYWNlIHByb3h5XG4gICAqXG4gICAqIEV4OiBbSnNpaVR5cGVQcm94eShuYXRpdmVUeXBlOiB0eXBlb2YoSVZlcnlCYXNlUHJvcHMpLCBmdWxseVF1YWxpZmllZE5hbWU6IFwiQHNjb3BlL2pzaWktY2FsYy1iYXNlLW9mLWJhc2UuVmVyeUJhc2VQcm9wc1wiKV1cbiAgICovXG4gIHB1YmxpYyBlbWl0QXR0cmlidXRlc0ZvckludGVyZmFjZVByb3h5KFxuICAgIGlmYzogc3BlYy5DbGFzc1R5cGUgfCBzcGVjLkludGVyZmFjZVR5cGUsXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IG5hbWUgPSBzcGVjLmlzSW50ZXJmYWNlVHlwZShpZmMpXG4gICAgICA/IHRoaXMubmFtZXV0aWxzLmNvbnZlcnRJbnRlcmZhY2VOYW1lKGlmYylcbiAgICAgIDogdGhpcy50eXBlcmVzb2x2ZXIudG9OYXRpdmVGcW4oaWZjLmZxbik7XG4gICAgdGhpcy5jb2RlLmxpbmUoXG4gICAgICBgW0pzaWlUeXBlUHJveHkobmF0aXZlVHlwZTogdHlwZW9mKCR7bmFtZX0pLCBmdWxseVF1YWxpZmllZE5hbWU6IFwiJHtpZmMuZnFufVwiKV1gLFxuICAgICk7XG4gICAgdGhpcy5lbWl0RGVwcmVjYXRlZEF0dHJpYnV0ZUlmTmVjZXNzYXJ5KGlmYyk7XG4gIH1cblxuICAvKipcbiAgICogRW1pdHMgdGhlIHByb3BlciBqc2lpIC5ORVQgYXR0cmlidXRlIGZvciBhbiBlbnVtXG4gICAqXG4gICAqIEV4OiBbSnNpaUVudW0obmF0aXZlVHlwZTogdHlwZW9mKFRlc3QpLCBmdWxseVF1YWxpZmllZE5hbWU6IFwianNpaS1jYWxjLlRlc3RcIildXG4gICAqL1xuICBwdWJsaWMgZW1pdEF0dHJpYnV0ZXNGb3JFbnVtKGVubTogc3BlYy5FbnVtVHlwZSwgZW51bU5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGpzaWlBdHRyaWJ1dGUgPSBgW0pzaWlFbnVtKG5hdGl2ZVR5cGU6IHR5cGVvZigke2VudW1OYW1lfSksIGZ1bGx5UXVhbGlmaWVkTmFtZTogXCIke2VubS5mcW59XCIpXWA7XG4gICAgdGhpcy5jb2RlLmxpbmUoanNpaUF0dHJpYnV0ZSk7XG4gICAgdGhpcy5lbWl0RGVwcmVjYXRlZEF0dHJpYnV0ZUlmTmVjZXNzYXJ5KGVubSk7XG4gIH1cblxuICAvKipcbiAgICogRW1pdHMgdGhlIHByb3BlciBqc2lpIC5ORVQgYXR0cmlidXRlIGZvciBhbiBlbnVtIG1lbWJlclxuICAgKlxuICAgKiBFeDogW0pzaWlFbnVtTWVtYmVyKG5hbWU6IFwiTm9ybWFsXCIpXVxuICAgKi9cbiAgcHVibGljIGVtaXRBdHRyaWJ1dGVzRm9yRW51bU1lbWJlcihcbiAgICBlbnVtTWVtYmVyTmFtZTogc3RyaW5nLFxuICAgIGVubW1lbWJlcjogc3BlYy5FbnVtTWVtYmVyLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCBqc2lpQXR0cmlidXRlID0gYFtKc2lpRW51bU1lbWJlcihuYW1lOiBcIiR7ZW51bU1lbWJlck5hbWV9XCIpXWA7XG4gICAgdGhpcy5jb2RlLmxpbmUoanNpaUF0dHJpYnV0ZSk7XG4gICAgdGhpcy5lbWl0RGVwcmVjYXRlZEF0dHJpYnV0ZUlmTmVjZXNzYXJ5KGVubW1lbWJlcik7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUganNpaSAuTkVUIG1ldGhvZCBpZGVudGlmaWVyXG4gICAqL1xuICBwdWJsaWMgY3JlYXRlSW52b2tlTWV0aG9kSWRlbnRpZmllcihcbiAgICBtZXRob2Q6IHNwZWMuTWV0aG9kLFxuICAgIGNsczogc3BlYy5DbGFzc1R5cGUsXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy50eXBlcmVzb2x2ZXIudG9OYXRpdmVGcW4oY2xzLmZxbik7XG4gICAgY29uc3QgaXNTdGF0aWMgPSBtZXRob2Quc3RhdGljID8gJ1N0YXRpYycgOiAnSW5zdGFuY2UnO1xuICAgIGNvbnN0IHJldHVybnMgPSBtZXRob2QucmV0dXJucyA/ICcnIDogJ1ZvaWQnO1xuICAgIGNvbnN0IGludm9rZU1ldGhvZE5hbWUgPSBtZXRob2QucmV0dXJuc1xuICAgICAgPyBgcmV0dXJuIEludm9rZSR7aXNTdGF0aWN9JHtyZXR1cm5zfU1ldGhvZGBcbiAgICAgIDogYEludm9rZSR7aXNTdGF0aWN9JHtyZXR1cm5zfU1ldGhvZGA7XG4gICAgY29uc3QgcmV0dXJuVHlwZSA9IG1ldGhvZC5yZXR1cm5zXG4gICAgICA/IGA8JHt0aGlzLnR5cGVyZXNvbHZlci50b0RvdE5ldFR5cGUobWV0aG9kLnJldHVybnMudHlwZSl9JHtcbiAgICAgICAgICBtZXRob2QucmV0dXJucy5vcHRpb25hbCA/ICc/JyA6ICcnXG4gICAgICAgIH0+YFxuICAgICAgOiAnJztcbiAgICAvLyBJZiB0aGUgbWV0aG9kIHJldHVybnMgYSBub24tb3B0aW9uYWwgdmFsdWUsIGFwcGx5IGEgXCIhXCIgdG8gc2lsZW5jZSBjb21waWxhdGlvbiB3YXJuaW5nLlxuICAgIGNvbnN0IGJhbmcgPSBtZXRob2QucmV0dXJucyAmJiAhbWV0aG9kLnJldHVybnMub3B0aW9uYWwgPyAnIScgOiAnJztcbiAgICBjb25zdCB0eXBlb2ZTdGF0ZW1lbnQgPSBtZXRob2Quc3RhdGljID8gYHR5cGVvZigke2NsYXNzTmFtZX0pLCBgIDogJyc7XG4gICAgY29uc3QgcGFyYW1UeXBlcyA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XG4gICAgY29uc3QgcGFyYW1zID0gbmV3IEFycmF5PHN0cmluZz4oKTtcbiAgICBpZiAobWV0aG9kLnBhcmFtZXRlcnMpIHtcbiAgICAgIGZvciAoY29uc3QgcGFyYW0gb2YgbWV0aG9kLnBhcmFtZXRlcnMpIHtcbiAgICAgICAgcGFyYW1UeXBlcy5wdXNoKFxuICAgICAgICAgIGB0eXBlb2YoJHt0aGlzLnR5cGVyZXNvbHZlci50b0RvdE5ldFR5cGUocGFyYW0udHlwZSl9JHtcbiAgICAgICAgICAgIHBhcmFtLnZhcmlhZGljID8gJ1tdJyA6ICcnXG4gICAgICAgICAgfSlgLFxuICAgICAgICApO1xuICAgICAgICBwYXJhbXMucHVzaCh0aGlzLm5hbWV1dGlscy5jb252ZXJ0UGFyYW1ldGVyTmFtZShwYXJhbS5uYW1lKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGhhc09wdGlvbmFsID1cbiAgICAgIG1ldGhvZC5wYXJhbWV0ZXJzPy5maW5kKChwYXJhbSkgPT4gcGFyYW0ub3B0aW9uYWwpICE9IG51bGwgPyAnPycgOiAnJztcbiAgICByZXR1cm4gYCR7aW52b2tlTWV0aG9kTmFtZX0ke3JldHVyblR5cGV9KCR7dHlwZW9mU3RhdGVtZW50fW5ldyBTeXN0ZW0uVHlwZVtdeyR7cGFyYW1UeXBlcy5qb2luKFxuICAgICAgJywgJyxcbiAgICApfX0sIG5ldyBvYmplY3Qke2hhc09wdGlvbmFsfVtdeyR7cGFyYW1zLmpvaW4oJywgJyl9fSkke2Jhbmd9O2A7XG4gIH1cblxuICAvKipcbiAgICogRW1pdHMgdGhlIHByb3BlciAuTkVUIGF0dHJpYnV0ZSBmb3IgYSBkZXByZWNhdGVkIGNsYXNzL2ludGVyZmFjZS9tZW1iZXJcbiAgICpcbiAgICogRXg6IFtTeXN0ZW0uT2Jzb2xldGUoKV1cbiAgICovXG4gIHB1YmxpYyBlbWl0RGVwcmVjYXRlZEF0dHJpYnV0ZUlmTmVjZXNzYXJ5KFxuICAgIG9iajpcbiAgICAgIHwgc3BlYy5NZXRob2RcbiAgICAgIHwgc3BlYy5DbGFzc1R5cGVcbiAgICAgIHwgc3BlYy5JbnRlcmZhY2VUeXBlXG4gICAgICB8IHNwZWMuUHJvcGVydHlcbiAgICAgIHwgc3BlYy5FbnVtVHlwZVxuICAgICAgfCBzcGVjLkVudW1NZW1iZXJcbiAgICAgIHwgc3BlYy5Jbml0aWFsaXplclxuICAgICAgfCB1bmRlZmluZWQsXG4gICk6IHZvaWQge1xuICAgIGlmICghb2JqKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGRvY3MgPSBvYmouZG9jcztcbiAgICBpZiAoZG9jcykge1xuICAgICAgaWYgKGRvY3Muc3RhYmlsaXR5ISA9PT0gc3BlYy5TdGFiaWxpdHkuRGVwcmVjYXRlZCkge1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBkb2NzLmRlcHJlY2F0ZWRcbiAgICAgICAgICA/IGBbU3lzdGVtLk9ic29sZXRlKFwiJHtkb2NzLmRlcHJlY2F0ZWRcbiAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCAnICcpIC8vIFJlcGxhY2luZyBuZXcgbGluZXMgaW4gT2Jzb2xldGVcbiAgICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKX1cIildYFxuICAgICAgICAgIDogJ1tTeXN0ZW0uT2Jzb2xldGUoKV0nO1xuICAgICAgICB0aGlzLmNvZGUubGluZShhdHRyaWJ1dGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19
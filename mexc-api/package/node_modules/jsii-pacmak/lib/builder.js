"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.IndependentPackageBuilder = void 0;
const path = require("path");
const logging = require("./logging");
const util_1 = require("./util");
/**
 * Base implementation, building the package targets for the given language independently of each other
 *
 * Some languages can gain substantial speedup in preparing an "uber project" for all packages
 * and compiling them all in one go (Those will be implementing a custom Builder).
 *
 * For languages where it doesn't matter--or where we haven't figured out how to
 * do that yet--this class can serve as a base class: it will build each package
 * independently, taking care to build them in the right order.
 */
class IndependentPackageBuilder {
    constructor(targetName, targetConstructor, modules, options) {
        this.targetName = targetName;
        this.targetConstructor = targetConstructor;
        this.modules = modules;
        this.options = options;
    }
    async buildModules() {
        if (this.options.codeOnly) {
            await Promise.all(util_1.flatten(this.modules).map((module) => this.generateModuleCode(module, this.options)));
            return;
        }
        for (const modules of this.modules) {
            // eslint-disable-next-line no-await-in-loop
            await Promise.all(modules.map((module) => this.buildModule(module, this.options)));
        }
    }
    async generateModuleCode(module, options) {
        const outputDir = this.finalOutputDir(module, options);
        logging.debug(`Generating ${this.targetName} code into ${outputDir}`);
        await this.makeTarget(module, options).generateCode(outputDir, module.tarball);
    }
    async buildModule(module, options) {
        const target = this.makeTarget(module, options);
        const outputDir = this.finalOutputDir(module, options);
        const src = await util_1.Scratch.make((tmpdir) => {
            logging.debug(`Generating ${this.targetName} code into ${tmpdir}`);
            return target.generateCode(tmpdir, module.tarball);
        });
        try {
            logging.debug(`Building ${src.directory} into ${outputDir}`);
            return await target.build(src.directory, outputDir);
        }
        catch (err) {
            logging.warn(`Failed building ${this.targetName}`);
            return await Promise.reject(err);
        }
        finally {
            if (options.clean) {
                logging.debug(`Cleaning ${src.directory}`);
                await src.cleanup();
            }
            else {
                logging.info(`Generated code for ${this.targetName} retained at ${src.directory}`);
            }
        }
    }
    makeTarget(module, options) {
        return new this.targetConstructor({
            targetName: this.targetName,
            packageDir: module.moduleDirectory,
            assembly: module.assembly,
            fingerprint: options.fingerprint,
            force: options.force,
            arguments: options.arguments,
            rosetta: options.rosetta,
        });
    }
    finalOutputDir(module, options) {
        if (options.languageSubdirectory) {
            return path.join(module.outputDirectory, this.targetName);
        }
        return module.outputDirectory;
    }
}
exports.IndependentPackageBuilder = IndependentPackageBuilder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJ1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsNkJBQTZCO0FBRTdCLHFDQUFxQztBQUtyQyxpQ0FBMEM7QUFrRDFDOzs7Ozs7Ozs7R0FTRztBQUNILE1BQWEseUJBQXlCO0lBQ3BDLFlBQ21CLFVBQXNCLEVBQ3RCLGlCQUFvQyxFQUNwQyxPQUErQixFQUMvQixPQUFxQjtRQUhyQixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsWUFBTyxHQUFQLE9BQU8sQ0FBd0I7UUFDL0IsWUFBTyxHQUFQLE9BQU8sQ0FBYztJQUNyQyxDQUFDO0lBRUcsS0FBSyxDQUFDLFlBQVk7UUFDdkIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUN6QixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ2YsY0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUNuQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FDOUMsQ0FDRixDQUFDO1lBQ0YsT0FBTztTQUNSO1FBRUQsS0FBSyxNQUFNLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2xDLDRDQUE0QztZQUM1QyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQ2hFLENBQUM7U0FDSDtJQUNILENBQUM7SUFFTyxLQUFLLENBQUMsa0JBQWtCLENBQUMsTUFBa0IsRUFBRSxPQUFxQjtRQUN4RSxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN2RCxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsSUFBSSxDQUFDLFVBQVUsY0FBYyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsWUFBWSxDQUNqRCxTQUFTLEVBQ1QsTUFBTSxDQUFDLE9BQU8sQ0FDZixDQUFDO0lBQ0osQ0FBQztJQUVPLEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBa0IsRUFBRSxPQUFxQjtRQUNqRSxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNoRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUV2RCxNQUFNLEdBQUcsR0FBRyxNQUFNLGNBQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUN4QyxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsSUFBSSxDQUFDLFVBQVUsY0FBYyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQ25FLE9BQU8sTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSTtZQUNGLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxHQUFHLENBQUMsU0FBUyxTQUFTLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFDN0QsT0FBTyxNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztTQUNyRDtRQUFDLE9BQU8sR0FBRyxFQUFFO1lBQ1osT0FBTyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7WUFDbkQsT0FBTyxNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDbEM7Z0JBQVM7WUFDUixJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Z0JBQ2pCLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztnQkFDM0MsTUFBTSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDckI7aUJBQU07Z0JBQ0wsT0FBTyxDQUFDLElBQUksQ0FDVixzQkFBc0IsSUFBSSxDQUFDLFVBQVUsZ0JBQWdCLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FDckUsQ0FBQzthQUNIO1NBQ0Y7SUFDSCxDQUFDO0lBRU8sVUFBVSxDQUFDLE1BQWtCLEVBQUUsT0FBcUI7UUFDMUQsT0FBTyxJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztZQUNoQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7WUFDM0IsVUFBVSxFQUFFLE1BQU0sQ0FBQyxlQUFlO1lBQ2xDLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUTtZQUN6QixXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVc7WUFDaEMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO1lBQ3BCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztZQUM1QixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87U0FDekIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVPLGNBQWMsQ0FBQyxNQUFrQixFQUFFLE9BQXFCO1FBQzlELElBQUksT0FBTyxDQUFDLG9CQUFvQixFQUFFO1lBQ2hDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUMzRDtRQUNELE9BQU8sTUFBTSxDQUFDLGVBQWUsQ0FBQztJQUNoQyxDQUFDO0NBQ0Y7QUFoRkQsOERBZ0ZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm9zZXR0YSB9IGZyb20gJ2pzaWktcm9zZXR0YSc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgKiBhcyBsb2dnaW5nIGZyb20gJy4vbG9nZ2luZyc7XG5pbXBvcnQgeyBKc2lpTW9kdWxlIH0gZnJvbSAnLi9wYWNrYWdpbmcnO1xuaW1wb3J0IHsgVGFyZ2V0Q29uc3RydWN0b3IsIFRhcmdldCB9IGZyb20gJy4vdGFyZ2V0JztcbmltcG9ydCB7IFRhcmdldE5hbWUgfSBmcm9tICcuL3RhcmdldHMnO1xuaW1wb3J0IHsgVG9wb3NvcnRlZCB9IGZyb20gJy4vdG9wb3NvcnQnO1xuaW1wb3J0IHsgU2NyYXRjaCwgZmxhdHRlbiB9IGZyb20gJy4vdXRpbCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRPcHRpb25zIHtcbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gZmluZ2VycHJpbnQgdGhlIHByb2R1Y2VkIGFydGlmYWN0cy5cbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgZmluZ2VycHJpbnQ/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGFydGlmYWN0cyBzaG91bGQgYmUgcmUtYnVpbGQgZXZlbiBpZiB0aGVpciBmaW5nZXJwcmludHMgbG9vayB1cC10by1kYXRlLlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgZm9yY2U/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBBcmd1bWVudHMgcHJvdmlkZWQgYnkgdGhlIHVzZXIgKGhvdyB0aGV5IGFyZSB1c2VkIGlzIHRhcmdldC1kZXBlbmRlbnQpXG4gICAqL1xuICBhcmd1bWVudHM6IHsgcmVhZG9ubHkgW25hbWU6IHN0cmluZ106IGFueSB9O1xuXG4gIC8qKlxuICAgKiBPbmx5IGdlbmVyYXRlIGNvZGUsIGRvbid0IGJ1aWxkXG4gICAqL1xuICBjb2RlT25seT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRvIGNsZWFuXG4gICAqL1xuICBjbGVhbj86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gYWRkIGFuIGFkZGl0aW9uYWwgc3ViZGlyZWN0b3J5IGZvciB0aGUgdGFyZ2V0IGxhbmd1YWdlXG4gICAqL1xuICBsYW5ndWFnZVN1YmRpcmVjdG9yeT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFRoZSBSb3NldHRhIGluc3RhbmNlIHRvIGxvYWQgZXhhbXBsZXMgZnJvbVxuICAgKi9cbiAgcm9zZXR0YTogUm9zZXR0YTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIGNsYXNzZXMgdGhhdCBjYW4gYnVpbGQgbGFuZ3VhZ2UgdGFyZ2V0c1xuICpcbiAqIEJ1aWxkaW5nIGNhbiBoYXBwZW4gb25lIHRhcmdldCBhdCBhIHRpbWUsIG9yIG11bHRpcGxlIHRhcmdldHMgYXQgYSB0aW1lLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRhcmdldEJ1aWxkZXIge1xuICBidWlsZE1vZHVsZXMoKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuLyoqXG4gKiBCYXNlIGltcGxlbWVudGF0aW9uLCBidWlsZGluZyB0aGUgcGFja2FnZSB0YXJnZXRzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2UgaW5kZXBlbmRlbnRseSBvZiBlYWNoIG90aGVyXG4gKlxuICogU29tZSBsYW5ndWFnZXMgY2FuIGdhaW4gc3Vic3RhbnRpYWwgc3BlZWR1cCBpbiBwcmVwYXJpbmcgYW4gXCJ1YmVyIHByb2plY3RcIiBmb3IgYWxsIHBhY2thZ2VzXG4gKiBhbmQgY29tcGlsaW5nIHRoZW0gYWxsIGluIG9uZSBnbyAoVGhvc2Ugd2lsbCBiZSBpbXBsZW1lbnRpbmcgYSBjdXN0b20gQnVpbGRlcikuXG4gKlxuICogRm9yIGxhbmd1YWdlcyB3aGVyZSBpdCBkb2Vzbid0IG1hdHRlci0tb3Igd2hlcmUgd2UgaGF2ZW4ndCBmaWd1cmVkIG91dCBob3cgdG9cbiAqIGRvIHRoYXQgeWV0LS10aGlzIGNsYXNzIGNhbiBzZXJ2ZSBhcyBhIGJhc2UgY2xhc3M6IGl0IHdpbGwgYnVpbGQgZWFjaCBwYWNrYWdlXG4gKiBpbmRlcGVuZGVudGx5LCB0YWtpbmcgY2FyZSB0byBidWlsZCB0aGVtIGluIHRoZSByaWdodCBvcmRlci5cbiAqL1xuZXhwb3J0IGNsYXNzIEluZGVwZW5kZW50UGFja2FnZUJ1aWxkZXIgaW1wbGVtZW50cyBUYXJnZXRCdWlsZGVyIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgdGFyZ2V0TmFtZTogVGFyZ2V0TmFtZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHRhcmdldENvbnN0cnVjdG9yOiBUYXJnZXRDb25zdHJ1Y3RvcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1vZHVsZXM6IFRvcG9zb3J0ZWQ8SnNpaU1vZHVsZT4sXG4gICAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBCdWlsZE9wdGlvbnMsXG4gICkge31cblxuICBwdWJsaWMgYXN5bmMgYnVpbGRNb2R1bGVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuY29kZU9ubHkpIHtcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICBmbGF0dGVuKHRoaXMubW9kdWxlcykubWFwKChtb2R1bGUpID0+XG4gICAgICAgICAgdGhpcy5nZW5lcmF0ZU1vZHVsZUNvZGUobW9kdWxlLCB0aGlzLm9wdGlvbnMpLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IG1vZHVsZXMgb2YgdGhpcy5tb2R1bGVzKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYXdhaXQtaW4tbG9vcFxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIG1vZHVsZXMubWFwKChtb2R1bGUpID0+IHRoaXMuYnVpbGRNb2R1bGUobW9kdWxlLCB0aGlzLm9wdGlvbnMpKSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZU1vZHVsZUNvZGUobW9kdWxlOiBKc2lpTW9kdWxlLCBvcHRpb25zOiBCdWlsZE9wdGlvbnMpIHtcbiAgICBjb25zdCBvdXRwdXREaXIgPSB0aGlzLmZpbmFsT3V0cHV0RGlyKG1vZHVsZSwgb3B0aW9ucyk7XG4gICAgbG9nZ2luZy5kZWJ1ZyhgR2VuZXJhdGluZyAke3RoaXMudGFyZ2V0TmFtZX0gY29kZSBpbnRvICR7b3V0cHV0RGlyfWApO1xuICAgIGF3YWl0IHRoaXMubWFrZVRhcmdldChtb2R1bGUsIG9wdGlvbnMpLmdlbmVyYXRlQ29kZShcbiAgICAgIG91dHB1dERpcixcbiAgICAgIG1vZHVsZS50YXJiYWxsLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGJ1aWxkTW9kdWxlKG1vZHVsZTogSnNpaU1vZHVsZSwgb3B0aW9uczogQnVpbGRPcHRpb25zKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5tYWtlVGFyZ2V0KG1vZHVsZSwgb3B0aW9ucyk7XG4gICAgY29uc3Qgb3V0cHV0RGlyID0gdGhpcy5maW5hbE91dHB1dERpcihtb2R1bGUsIG9wdGlvbnMpO1xuXG4gICAgY29uc3Qgc3JjID0gYXdhaXQgU2NyYXRjaC5tYWtlKCh0bXBkaXIpID0+IHtcbiAgICAgIGxvZ2dpbmcuZGVidWcoYEdlbmVyYXRpbmcgJHt0aGlzLnRhcmdldE5hbWV9IGNvZGUgaW50byAke3RtcGRpcn1gKTtcbiAgICAgIHJldHVybiB0YXJnZXQuZ2VuZXJhdGVDb2RlKHRtcGRpciwgbW9kdWxlLnRhcmJhbGwpO1xuICAgIH0pO1xuXG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dpbmcuZGVidWcoYEJ1aWxkaW5nICR7c3JjLmRpcmVjdG9yeX0gaW50byAke291dHB1dERpcn1gKTtcbiAgICAgIHJldHVybiBhd2FpdCB0YXJnZXQuYnVpbGQoc3JjLmRpcmVjdG9yeSwgb3V0cHV0RGlyKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dpbmcud2FybihgRmFpbGVkIGJ1aWxkaW5nICR7dGhpcy50YXJnZXROYW1lfWApO1xuICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UucmVqZWN0KGVycik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChvcHRpb25zLmNsZWFuKSB7XG4gICAgICAgIGxvZ2dpbmcuZGVidWcoYENsZWFuaW5nICR7c3JjLmRpcmVjdG9yeX1gKTtcbiAgICAgICAgYXdhaXQgc3JjLmNsZWFudXAoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dpbmcuaW5mbyhcbiAgICAgICAgICBgR2VuZXJhdGVkIGNvZGUgZm9yICR7dGhpcy50YXJnZXROYW1lfSByZXRhaW5lZCBhdCAke3NyYy5kaXJlY3Rvcnl9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG1ha2VUYXJnZXQobW9kdWxlOiBKc2lpTW9kdWxlLCBvcHRpb25zOiBCdWlsZE9wdGlvbnMpOiBUYXJnZXQge1xuICAgIHJldHVybiBuZXcgdGhpcy50YXJnZXRDb25zdHJ1Y3Rvcih7XG4gICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsXG4gICAgICBwYWNrYWdlRGlyOiBtb2R1bGUubW9kdWxlRGlyZWN0b3J5LFxuICAgICAgYXNzZW1ibHk6IG1vZHVsZS5hc3NlbWJseSxcbiAgICAgIGZpbmdlcnByaW50OiBvcHRpb25zLmZpbmdlcnByaW50LFxuICAgICAgZm9yY2U6IG9wdGlvbnMuZm9yY2UsXG4gICAgICBhcmd1bWVudHM6IG9wdGlvbnMuYXJndW1lbnRzLFxuICAgICAgcm9zZXR0YTogb3B0aW9ucy5yb3NldHRhLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBmaW5hbE91dHB1dERpcihtb2R1bGU6IEpzaWlNb2R1bGUsIG9wdGlvbnM6IEJ1aWxkT3B0aW9ucyk6IHN0cmluZyB7XG4gICAgaWYgKG9wdGlvbnMubGFuZ3VhZ2VTdWJkaXJlY3RvcnkpIHtcbiAgICAgIHJldHVybiBwYXRoLmpvaW4obW9kdWxlLm91dHB1dERpcmVjdG9yeSwgdGhpcy50YXJnZXROYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIG1vZHVsZS5vdXRwdXREaXJlY3Rvcnk7XG4gIH1cbn1cbiJdfQ==